üîù Retour au [Sommaire](/SOMMAIRE.md)

# 3.3 Gestion des utilisateurs et groupes

La gestion des utilisateurs et groupes est fondamentale pour la s√©curit√© et l'organisation de votre syst√®me Debian. Imaginez votre syst√®me comme un immeuble : chaque utilisateur a son appartement (dossier personnel) et ses cl√©s (permissions) pour acc√©der aux parties communes (ressources syst√®me).

## Concepts de base

### Qu'est-ce qu'un utilisateur ?

Un utilisateur est une identit√© dans le syst√®me qui permet :
- **L'authentification** : Se connecter avec un nom et mot de passe
- **L'autorisation** : D√©finir ce qu'il peut faire ou non
- **La tra√ßabilit√©** : Identifier qui fait quoi
- **L'organisation** : S√©parer les donn√©es et processus

### Qu'est-ce qu'un groupe ?

Un groupe est un ensemble d'utilisateurs qui partagent certaines permissions. C'est comme organiser les habitants de l'immeuble par int√©r√™ts : le groupe "cuisine" peut acc√©der √† la cuisine commune, le groupe "admin" peut g√©rer l'immeuble.

### Types d'utilisateurs

1. **root** : L'administrateur supr√™me (propri√©taire de l'immeuble)
2. **Utilisateurs syst√®me** : Services et processus (personnel d'entretien)
3. **Utilisateurs normaux** : Personnes physiques (locataires)

### Fichiers importants

- `/etc/passwd` : Informations des utilisateurs
- `/etc/group` : Informations des groupes
- `/etc/shadow` : Mots de passe chiffr√©s
- `/etc/gshadow` : Mots de passe des groupes (rarement utilis√©)

## 3.3.1 Cr√©ation et suppression d'utilisateurs

### Examiner les utilisateurs existants

```bash
# Voir tous les utilisateurs
cat /etc/passwd

# Exemple de ligne :
# marie:x:1001:1001:Marie Dupont,,,:/home/marie:/bin/bash

# Format : nom:password:UID:GID:info:home:shell
```

**Explication des champs :**
- **marie** : Nom d'utilisateur
- **x** : Mot de passe (stock√© dans /etc/shadow)
- **1001** : UID (User ID) - num√©ro unique
- **1001** : GID (Group ID) - groupe principal
- **Marie Dupont,,,** : Informations compl√®tes (GECOS)
- **/home/marie** : R√©pertoire personnel
- **/bin/bash** : Shell par d√©faut

### Cr√©ation d'utilisateurs avec useradd

#### M√©thode basique

```bash
# Cr√©er un utilisateur simple
sudo useradd jean

# Cr√©er avec r√©pertoire personnel
sudo useradd -m pierre

# Cr√©er avec shell sp√©cifique
sudo useradd -m -s /bin/bash sophie
```

#### M√©thode compl√®te (recommand√©e)

```bash
# Cr√©ation compl√®te d'un utilisateur
sudo useradd -m -s /bin/bash -c "Jean Martin" -G sudo,users jean

# Options expliqu√©es :
# -m : cr√©er le r√©pertoire personnel
# -s : d√©finir le shell
# -c : commentaire/nom complet
# -G : groupes suppl√©mentaires
```

#### Options utiles de useradd

```bash
# Sp√©cifier l'UID
sudo useradd -m -u 1500 alice

# Sp√©cifier le r√©pertoire personnel
sudo useradd -m -d /home/special/bob bob

# D√©finir une date d'expiration
sudo useradd -m -e 2024-12-31 temporaire

# Cr√©er un utilisateur syst√®me (pas de login)
sudo useradd -r -s /bin/false service_web
```

### D√©finir le mot de passe

```bash
# D√©finir le mot de passe interactivement
sudo passwd jean

# Forcer le changement au premier login
sudo passwd -e jean

# D√©finir un mot de passe depuis un script (attention √† la s√©curit√©)
echo "jean:motdepasse123" | sudo chpasswd
```

### Cr√©ation d'utilisateurs avec adduser (plus convivial)

```bash
# M√©thode interactive (plus simple pour d√©buter)
sudo adduser marie

# Cette commande va :
# 1. Cr√©er l'utilisateur
# 2. Cr√©er le r√©pertoire personnel
# 3. Copier les fichiers de configuration par d√©faut
# 4. Demander le mot de passe
# 5. Demander les informations personnelles
```

### Suppression d'utilisateurs

```bash
# Supprimer un utilisateur (garder le r√©pertoire personnel)
sudo userdel jean

# Supprimer utilisateur ET son r√©pertoire personnel
sudo userdel -r marie

# Forcer la suppression m√™me si l'utilisateur est connect√©
sudo userdel -f pierre

# M√©thode interactive (plus s√ªre)
sudo deluser sophie

# Supprimer aussi le r√©pertoire personnel
sudo deluser --remove-home thomas
```

### V√©rifications apr√®s cr√©ation/suppression

```bash
# V√©rifier la cr√©ation
id nouvel_utilisateur
grep nouvel_utilisateur /etc/passwd

# V√©rifier les groupes
groups nouvel_utilisateur

# Tester la connexion (depuis un autre terminal)
su - nouvel_utilisateur
```

## 3.3.2 Modification des comptes

### Modification avec usermod

#### Changer les informations de base

```bash
# Changer le nom complet
sudo usermod -c "Marie Dubois" marie

# Changer le r√©pertoire personnel
sudo usermod -d /home/nouveau_dossier -m marie

# Changer le shell
sudo usermod -s /bin/zsh marie

# Changer l'UID (attention aux permissions des fichiers)
sudo usermod -u 1500 marie
```

#### Gestion des groupes

```bash
# Ajouter √† un groupe suppl√©mentaire
sudo usermod -a -G admin marie

# Remplacer tous les groupes suppl√©mentaires
sudo usermod -G users,developers marie

# Changer le groupe principal
sudo usermod -g developers marie

# Retirer d'un groupe (pas d'option directe, utiliser gpasswd)
sudo gpasswd -d marie admin
```

#### Gestion de l'expiration et verrouillage

```bash
# D√©finir une date d'expiration
sudo usermod -e 2024-12-31 marie

# Supprimer la date d'expiration
sudo usermod -e "" marie

# Verrouiller un compte (d√©sactiver le mot de passe)
sudo usermod -L marie

# D√©verrouiller un compte
sudo usermod -U marie
```

### Modification avec chage (Change Age)

La commande `chage` g√®re la politique des mots de passe :

```bash
# Voir les informations d'expiration
sudo chage -l marie

# Forcer le changement au prochain login
sudo chage -d 0 marie

# D√©finir l'expiration du mot de passe (90 jours)
sudo chage -M 90 marie

# D√©finir un avertissement 7 jours avant expiration
sudo chage -W 7 marie

# Interdire le changement pendant 1 jour
sudo chage -m 1 marie

# Mode interactif
sudo chage marie
```

### Informations sur les utilisateurs

```bash
# Informations compl√®tes d'un utilisateur
id marie
finger marie  # Si install√© : apt install finger

# Voir les connexions r√©centes
last marie
lastlog | grep marie

# Voir qui est connect√© actuellement
who
w
```

## 3.3.3 Gestion des mots de passe (PAM)

### Introduction √† PAM (Pluggable Authentication Modules)

PAM est le syst√®me qui g√®re l'authentification sur Debian. Il permet de d√©finir des politiques de s√©curit√© flexibles sans modifier chaque application.

### Fichiers de configuration PAM

Les fichiers de configuration se trouvent dans `/etc/pam.d/` :

```bash
# Voir les configurations PAM disponibles
ls /etc/pam.d/

# Fichiers importants :
# - common-auth : authentification
# - common-password : politique des mots de passe
# - common-session : gestion des sessions
# - login : connexion en console
# - sshd : connexion SSH
# - sudo : utilisation de sudo
```

### Politique des mots de passe

#### Configuration de base

```bash
# Voir la configuration actuelle des mots de passe
sudo cat /etc/pam.d/common-password

# Exemple de ligne importante :
# password requisite pam_pwquality.so retry=3
```

#### Installation et configuration de pwquality

```bash
# Installer le module de qualit√© des mots de passe
sudo apt update
sudo apt install libpam-pwquality

# Configurer la politique
sudo nano /etc/security/pwquality.conf
```

#### Options importantes dans pwquality.conf

```bash
# Longueur minimale
minlen = 8

# Nombre minimum de classes de caract√®res (majuscules, minuscules, chiffres, symboles)
minclass = 3

# Nombre maximum de caract√®res cons√©cutifs identiques
maxrepeat = 2

# Interdire les mots de passe bas√©s sur le nom d'utilisateur
usercheck = 1

# Cr√©dit pour les caract√®res sp√©ciaux (n√©gatif = obligatoire)
ocredit = -1  # Au moins 1 caract√®re sp√©cial

# Exemple de configuration compl√®te :
# minlen = 10
# minclass = 3
# maxrepeat = 2
# ucredit = -1    # Au moins 1 majuscule
# lcredit = -1    # Au moins 1 minuscule
# dcredit = -1    # Au moins 1 chiffre
# ocredit = -1    # Au moins 1 caract√®re sp√©cial
```

### Gestion avanc√©e des mots de passe

#### Historique des mots de passe

```bash
# Emp√™cher la r√©utilisation des 5 derniers mots de passe
# Ajouter √† /etc/pam.d/common-password :
# password required pam_pwhistory.so remember=5
```

#### Tentatives de connexion

```bash
# Limiter les tentatives de connexion (protection contre brute force)
# Installer pam_tally2
sudo apt install libpam-modules

# Configuration dans /etc/pam.d/common-auth :
# auth required pam_tally2.so deny=3 unlock_time=600

# Voir les tentatives √©chou√©es
sudo pam_tally2 --user marie

# R√©initialiser les compteurs
sudo pam_tally2 --user marie --reset
```

### Commandes de gestion des mots de passe

```bash
# Changer son propre mot de passe
passwd

# Changer le mot de passe d'un autre utilisateur (en tant que root)
sudo passwd marie

# G√©n√©rer un mot de passe al√©atoirement
pwgen 12 1  # Si install√© : apt install pwgen

# V√©rifier la force d'un mot de passe
echo "motdepasse" | pwscore  # Si pwquality install√©
```

## 3.3.4 Sudo et privil√®ges avanc√©s

### Qu'est-ce que sudo ?

`sudo` (Super User DO) permet √† des utilisateurs normaux d'ex√©cuter des commandes avec les privil√®ges d'un autre utilisateur (g√©n√©ralement root), de mani√®re contr√¥l√©e et trac√©e.

### Avantages de sudo

1. **S√©curit√©** : Pas besoin de partager le mot de passe root
2. **Tra√ßabilit√©** : Toutes les actions sont enregistr√©es
3. **Granularit√©** : Permissions sp√©cifiques par utilisateur/commande
4. **Temporaire** : Privil√®ges limit√©s dans le temps

### Configuration de base

#### Ajouter un utilisateur au groupe sudo

```bash
# M√©thode 1 : Ajouter au groupe sudo
sudo usermod -a -G sudo marie

# M√©thode 2 : Utiliser adduser
sudo adduser marie sudo

# V√©rifier l'appartenance au groupe
groups marie
```

#### Le fichier sudoers

```bash
# JAMAIS √©diter directement /etc/sudoers !
# Toujours utiliser visudo pour √©viter les erreurs
sudo visudo

# Fichier principal : /etc/sudoers
# Fichiers additionnels : /etc/sudoers.d/
```

### Configuration avanc√©e de sudo

#### Syntaxe de base dans sudoers

```bash
# Format g√©n√©ral :
# utilisateur h√¥te=(utilisateur_cible) commande

# Exemples :
marie ALL=(ALL:ALL) ALL              # Marie peut tout faire
bob ALL=(root) /bin/systemctl        # Bob peut utiliser systemctl
alice ALL=NOPASSWD: /usr/bin/apt     # Alice peut utiliser apt sans mot de passe
```

#### Utilisation des groupes

```bash
# Permettre √† tous les membres du groupe admin
%admin ALL=(ALL) ALL

# Groupe avec commandes sp√©cifiques
%developers ALL=(www-data) /usr/bin/git, /bin/chown
```

#### Cr√©er des fichiers sudoers sp√©cifiques

```bash
# Cr√©er un fichier pour un utilisateur sp√©cifique
sudo visudo -f /etc/sudoers.d/marie

# Contenu du fichier :
marie ALL=(ALL) NOPASSWD: /bin/systemctl, /usr/bin/apt
```

### Utilisation de sudo

#### Commandes de base

```bash
# Ex√©cuter une commande en tant que root
sudo commande

# Ex√©cuter en tant qu'un autre utilisateur
sudo -u www-data commande

# Obtenir un shell root temporaire
sudo -i

# Ex√©cuter plusieurs commandes
sudo bash -c "commande1 && commande2"

# Voir les privil√®ges sudo actuels
sudo -l
```

#### Gestion des sessions sudo

```bash
# Prolonger la session sudo (√©viter de retaper le mot de passe)
sudo -v

# Terminer la session sudo
sudo -k

# Voir l'historique des commandes sudo
sudo cat /var/log/auth.log | grep sudo
```

### Politiques avanc√©es

#### Limitations temporelles

```bash
# Dans /etc/sudoers ou fichier sudoers.d :
# Permettre seulement pendant les heures de bureau
marie ALL=(ALL) ALL, !SU, !SHELLS /usr/bin/apt

# Avec timestamp_timeout (dur√©e de validit√© en minutes)
Defaults timestamp_timeout=30
```

#### Restrictions de commandes

```bash
# Interdire certaines commandes dangereuses
marie ALL=(ALL) ALL, !/bin/su, !/usr/bin/passwd root, !/bin/bash

# Alias pour grouper des commandes
User_Alias WEBADMINS = marie, jean
Cmnd_Alias WEBCOMMANDS = /usr/bin/systemctl restart apache2, /usr/bin/systemctl reload apache2
WEBADMINS ALL=(ALL) WEBCOMMANDS
```

### Surveillance et s√©curit√©

#### Journalisation

```bash
# Voir les actions sudo dans les logs
sudo journalctl | grep sudo
grep sudo /var/log/auth.log

# Configuration pour log plus d√©taill√© dans sudoers :
Defaults log_input, log_output
Defaults logfile="/var/log/sudo.log"
```

#### Scripts de surveillance

```bash
# Cr√©er un script de surveillance sudo
sudo nano /usr/local/bin/sudo-monitor.sh

#!/bin/bash
# Surveiller les utilisations de sudo
tail -f /var/log/auth.log | grep --line-buffered sudo | while read line; do
    echo "$(date): $line" >> /var/log/sudo-monitor.log
done
```

### Alternatives et outils compl√©mentaires

#### su vs sudo

```bash
# su : Switch User (m√©thode traditionnelle)
su -                    # Devenir root (demande le mot de passe root)
su - marie             # Devenir marie
su -c "commande" marie # Ex√©cuter une commande en tant que marie

# Diff√©rences :
# su : utilise le mot de passe de l'utilisateur cible
# sudo : utilise votre propre mot de passe
```

#### PolicyKit (pkexec)

```bash
# √âquivalent graphique de sudo pour les applications
pkexec gparted  # Lance gparted avec privil√®ges administrateur

# Configuration dans /usr/share/polkit-1/actions/
```

### Bonnes pratiques de s√©curit√©

1. **Principe du moindre privil√®ge** : Donnez seulement les permissions n√©cessaires
2. **Utilisez des groupes** plut√¥t que des permissions individuelles
3. **Auditez r√©guli√®rement** les permissions sudo
4. **Surveillez les logs** sudo
5. **√âvitez NOPASSWD** sauf cas sp√©cifiques
6. **Testez les configurations** avec `visudo -c`
7. **Documentez** vos politiques de permissions

### Groupes syst√®me importants

```bash
# Groupes avec privil√®ges sp√©ciaux sur Debian :
adm      # Lecture des logs syst√®me
sudo     # Utilisation de sudo
wheel    # Groupe administrateur alternatif (pas par d√©faut sur Debian)
lpadmin  # Administration des imprimantes
sambashare # Partage Samba
cdrom    # Acc√®s aux lecteurs CD/DVD
floppy   # Acc√®s aux lecteurs disquettes
audio    # Acc√®s aux p√©riph√©riques audio
video    # Acc√®s aux p√©riph√©riques vid√©o
netdev   # Configuration r√©seau
```

Cette gestion fine des utilisateurs et des privil√®ges constitue la base de la s√©curit√© de votre syst√®me Debian. Elle vous permet de cr√©er un environnement s√ªr o√π chaque utilisateur a exactement les permissions dont il a besoin, ni plus ni moins.

‚è≠Ô∏è
