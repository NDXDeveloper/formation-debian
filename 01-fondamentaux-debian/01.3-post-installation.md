# 1.3 Post-installation

*Guide d√©butant - Dur√©e estim√©e : 2h30*

---

## üéØ Objectifs de cette section

√Ä la fin de cette section, vous saurez :
- Effectuer la configuration initiale optimale apr√®s installation
- Cr√©er et g√©rer des utilisateurs et groupes syst√®me
- Configurer et s√©curiser les droits sudo
- Maintenir votre syst√®me √† jour efficacement
- Appliquer les bonnes pratiques de s√©curit√© de base

---

## 1.3.1 Premier d√©marrage et configuration initiale

### üöÄ Que faire apr√®s la premi√®re connexion ?

F√©licitations ! Votre Debian est install√©, mais ce n'est que le d√©but. Comme une voiture neuve qui sort du garage, votre syst√®me a besoin de quelques r√©glages pour √™tre parfaitement op√©rationnel.

#### Les priorit√©s du premier d√©marrage

1. **V√©rifier que tout fonctionne** ‚úÖ
2. **S√©curiser le syst√®me** üîí
3. **Mettre √† jour** üîÑ
4. **Personnaliser** üé®
5. **Installer les outils essentiels** üõ†Ô∏è

### üîç Diagnostic initial du syst√®me

#### V√©rifications automatiques post-installation

```bash
# Ouvrir un terminal (Ctrl + Alt + T)

# V√©rifier l'identit√© du syst√®me
hostnamectl
# R√©sultat : Informations compl√®tes sur votre syst√®me

# V√©rifier l'√©tat g√©n√©ral
systemctl status
# R√©sultat : √âtat des services principaux

# V√©rifier l'espace disque
df -h /
# R√©sultat : Utilisation de la partition racine

# V√©rifier la m√©moire
free -h
# R√©sultat : Utilisation de la RAM
```

#### Informations syst√®me importantes

```bash
# Version exacte de Debian
cat /etc/debian_version
# Exemple : 12.4

# Informations d√©taill√©es
lsb_release -a
# R√©sultat complet : Debian 12 "Bookworm"

# Architecture du processeur
uname -m
# R√©sultat : x86_64 (64 bits)

# Noyau Linux utilis√©
uname -r
# Exemple : 6.1.0-18-amd64
```

### üåê Configuration r√©seau avanc√©e

#### V√©rifier la configuration automatique

```bash
# Voir toutes les interfaces r√©seau
ip addr show
# Observer : eth0, enp0s3, ou wlan0

# Voir la configuration DNS
cat /etc/resolv.conf
# V√©rifier : Serveurs DNS configur√©s

# Tester la connectivit√© compl√®te
ping -c 3 8.8.8.8  # Test IP pure
ping -c 3 google.com  # Test r√©solution DNS
```

#### Configuration WiFi (si n√©cessaire)

**Via l'interface graphique** :
1. Clic sur l'ic√¥ne r√©seau (coin sup√©rieur droit)
2. "Param√®tres WiFi"
3. S√©lectionner votre r√©seau
4. Saisir la cl√© WiFi

**Via la ligne de commande** :
```bash
# Lister les r√©seaux WiFi disponibles
sudo iwlist scan | grep ESSID

# Se connecter √† un r√©seau (m√©thode simple)
sudo nmcli dev wifi connect "NomDuReseau" password "MotDePasse"

# V√©rifier la connexion
nmcli connection show
```

### üïí Configuration de l'heure et localisation

#### V√©rifier et ajuster le fuseau horaire

```bash
# Voir le fuseau horaire actuel
timedatectl
# R√©sultat : Timezone, heure locale et UTC

# Lister les fuseaux horaires disponibles
timedatectl list-timezones | grep Europe
# Trouver : Europe/Paris, Europe/London, etc.

# Changer si n√©cessaire
sudo timedatectl set-timezone Europe/Paris

# Synchroniser avec Internet
sudo timedatectl set-ntp true
```

#### Configuration des formats r√©gionaux

```bash
# Voir la configuration locale actuelle
locale
# R√©sultat : Variables LANG, LC_TIME, etc.

# Lister les locales disponibles
locale -a | grep fr_FR

# Reconfigurer si n√©cessaire
sudo dpkg-reconfigure locales
```

### üñ•Ô∏è Optimisation de l'affichage

#### R√©solution et √©chelle d'√©cran

**Via GNOME** :
1. Param√®tres ‚Üí Affichage
2. Ajuster la r√©solution
3. Modifier l'√©chelle si texte trop petit/grand
4. Tester et appliquer

**Via ligne de commande** :
```bash
# Voir les r√©solutions disponibles
xrandr
# R√©sultat : Liste des modes d'affichage

# Changer la r√©solution (exemple)
xrandr --output Virtual-1 --mode 1920x1080
```

#### Configuration des polices

```bash
# Installer des polices suppl√©mentaires
sudo apt update
sudo apt install fonts-liberation fonts-dejavu-extra

# V√©rifier les polices install√©es
fc-list | head -10
```

---

## 1.3.2 Gestion des utilisateurs et groupes

### üë• Comprendre les utilisateurs Linux

#### Les types d'utilisateurs

**Utilisateur root (UID 0)** :
- **R√¥le** : Administrateur syst√®me tout-puissant
- **Pouvoirs** : Peut tout faire, tout modifier, tout casser
- **Analogie** : PDG d'une entreprise avec tous les pouvoirs
- **Usage** : Uniquement pour l'administration syst√®me

**Utilisateurs normaux (UID ‚â• 1000)** :
- **R√¥le** : Utilisateurs quotidiens du syst√®me
- **Pouvoirs** : Limit√©s √† leur dossier personnel et applications
- **Analogie** : Employ√©s avec des permissions sp√©cifiques
- **Usage** : Travail quotidien, navigation, bureautique

**Utilisateurs syst√®me (UID 1-999)** :
- **R√¥le** : Services et d√©mons syst√®me
- **Exemples** : www-data (Apache), mysql, mail
- **Usage** : Interne au syst√®me, pas de connexion directe

### üîç Explorer les utilisateurs existants

```bash
# Voir tous les utilisateurs du syst√®me
cat /etc/passwd
# Format : nom:mot_de_passe:UID:GID:description:dossier:shell

# Voir seulement les utilisateurs "humains"
cat /etc/passwd | grep "/home"

# Voir l'utilisateur actuel
whoami
id
# R√©sultat : Votre nom et vos identifiants num√©riques

# Voir les groupes de l'utilisateur actuel
groups
# Exemple : jean adm cdrom sudo dip plugdev users
```

### üë§ Cr√©er de nouveaux utilisateurs

#### M√©thode recommand√©e : adduser

```bash
# Cr√©er un nouvel utilisateur (en tant que root ou avec sudo)
sudo adduser marie
# L'assistant vous guide :
# - Mot de passe
# - Nom complet
# - Num√©ro de t√©l√©phone (optionnel)
# - Etc.

# V√©rifier la cr√©ation
sudo cat /etc/passwd | grep marie
ls -la /home/
# Observer : Dossier /home/marie cr√©√© automatiquement
```

#### M√©thode avanc√©e : useradd

```bash
# Cr√©ation manuelle compl√®te
sudo useradd -m -s /bin/bash -c "Marie Martin" marie
# -m : Cr√©er le dossier home
# -s : Shell par d√©faut
# -c : Commentaire (nom complet)

# D√©finir un mot de passe
sudo passwd marie
# Saisir et confirmer le mot de passe
```

### üè∑Ô∏è Comprendre et g√©rer les groupes

#### Qu'est-ce qu'un groupe ?

**Analogie** : Un groupe est comme un "club" ou une "√©quipe" dans une entreprise. Chaque club a des permissions sp√©cifiques.

**Exemples de groupes importants** :
- **sudo** : Peut utiliser la commande sudo (administrateurs)
- **adm** : Peut lire les logs syst√®me
- **cdrom** : Peut utiliser les lecteurs CD/DVD
- **audio** : Peut utiliser les p√©riph√©riques audio
- **video** : Peut utiliser les p√©riph√©riques vid√©o
- **plugdev** : Peut monter des p√©riph√©riques USB

#### Gestion des groupes

```bash
# Voir tous les groupes du syst√®me
cat /etc/group

# Voir les groupes d'un utilisateur sp√©cifique
groups marie

# Cr√©er un nouveau groupe
sudo groupadd developpeurs

# Ajouter un utilisateur √† un groupe
sudo usermod -aG developpeurs marie
# -a : Ajouter (sans enlever des autres groupes)
# -G : Groupes secondaires

# Retirer un utilisateur d'un groupe
sudo deluser marie cdrom
```

### üîß Modifier les utilisateurs existants

#### Changements courants

```bash
# Changer le nom complet (GECOS)
sudo usermod -c "Marie Martin-Dupont" marie

# Changer le shell par d√©faut
sudo usermod -s /bin/zsh marie

# Changer le dossier home
sudo usermod -d /home/marie_new marie

# Verrouiller un compte temporairement
sudo usermod -L marie
# D√©verrouiller
sudo usermod -U marie
```

#### Changer les mots de passe

```bash
# Changer son propre mot de passe
passwd
# Saisir l'ancien puis le nouveau

# Changer le mot de passe d'un autre utilisateur (sudo requis)
sudo passwd marie

# Forcer le changement au prochain login
sudo passwd -e marie
```

### üóëÔ∏è Supprimer des utilisateurs

#### Suppression simple

```bash
# Supprimer un utilisateur mais garder son dossier home
sudo deluser marie

# Supprimer un utilisateur ET son dossier home
sudo deluser --remove-home marie

# Supprimer compl√®tement (utilisateur + home + mail)
sudo deluser --remove-all-files marie
```

#### ‚ö†Ô∏è Pr√©cautions importantes

```bash
# TOUJOURS v√©rifier avant suppression
# 1. Voir les processus de l'utilisateur
ps aux | grep marie

# 2. Voir les fichiers appartenant √† l'utilisateur
sudo find / -user marie 2>/dev/null

# 3. Sauvegarder les donn√©es importantes
sudo cp -r /home/marie /backup/marie-$(date +%Y%m%d)
```

---

## 1.3.3 Configuration de sudo

### üîê Qu'est-ce que sudo ?

#### Principe de fonctionnement

**sudo** = "**S**ubstitute **U**ser **DO**" (ou "**S**uper **U**ser **DO**")

**Analogie** : sudo est comme un badge d'acc√®s temporaire dans une entreprise. Au lieu de donner les cl√©s du bureau du directeur √† tous les employ√©s, on leur donne un badge qui permet d'y acc√©der temporairement quand n√©cessaire.

#### Avantages par rapport √† root direct

| Aspect | Connexion root | sudo |
|--------|----------------|------|
| **S√©curit√©** | Tr√®s risqu√© | S√©curis√© |
| **Tra√ßabilit√©** | Limit√©e | Compl√®te |
| **Granularit√©** | Tout ou rien | Permissions cibl√©es |
| **Dur√©e** | Session compl√®te | Commande par commande |

### üìã V√©rifier la configuration sudo actuelle

```bash
# V√©rifier si vous avez les droits sudo
sudo whoami
# R√©sultat attendu : root

# Voir votre configuration sudo
sudo -l
# R√©sultat : Liste des commandes autoris√©es

# Voir les membres du groupe sudo
getent group sudo
# R√©sultat : sudo:x:27:votre-nom
```

### ‚öôÔ∏è Configuration du fichier sudoers

#### Le fichier /etc/sudoers

**‚ö†Ô∏è ATTENTION** : Ne JAMAIS √©diter directement /etc/sudoers !
**Toujours utiliser** : `sudo visudo`

```bash
# √âditer la configuration sudo de mani√®re s√©curis√©e
sudo visudo
```

#### Comprendre la syntaxe de base

```bash
# Format g√©n√©ral :
# utilisateur h√¥te=(utilisateur_cible) commandes

# Exemples dans /etc/sudoers :
%sudo   ALL=(ALL:ALL) ALL
# %sudo : Groupe sudo
# ALL : Tous les h√¥tes
# (ALL:ALL) : Peut devenir n'importe quel utilisateur/groupe
# ALL : Peut ex√©cuter toutes les commandes
```

### üéØ Configurations sudo courantes

#### Donner tous les droits √† un utilisateur

```bash
# Ajouter √† la fin du fichier (via visudo)
marie ALL=(ALL:ALL) ALL
```

#### Autoriser des commandes sp√©cifiques

```bash
# Permettre seulement la gestion des services
marie ALL=(ALL) /bin/systemctl

# Permettre plusieurs commandes sp√©cifiques
marie ALL=(ALL) /bin/systemctl, /sbin/reboot, /sbin/shutdown

# Permettre apt sans mot de passe
marie ALL=(ALL) NOPASSWD: /usr/bin/apt, /usr/bin/apt-get
```

#### Cr√©er des groupes personnalis√©s

```bash
# Dans visudo, cr√©er des alias
Cmnd_Alias SERVICES = /bin/systemctl, /sbin/service
Cmnd_Alias NETWORK = /sbin/ifconfig, /bin/netstat

# Puis les utiliser
%admin ALL=(ALL) SERVICES, NETWORK
```

### üîí S√©curiser sudo

#### Bonnes pratiques de s√©curit√©

```bash
# Dans visudo, ajouter des options de s√©curit√© :

# Exiger le mot de passe pour chaque sudo (par d√©faut)
Defaults timestamp_timeout=0

# Logger toutes les commandes sudo
Defaults logfile="/var/log/sudo.log"

# Envoyer un mail en cas de tentative non autoris√©e
Defaults mailto="admin@example.com"
Defaults mail_badpass, mail_no_user, mail_no_perms
```

#### Tester la configuration

```bash
# V√©rifier la syntaxe avant de sauvegarder
sudo visudo -c
# R√©sultat : /etc/sudoers: parsed OK

# Tester avec un autre terminal (garder celui-ci ouvert !)
# Dans un nouveau terminal :
sudo whoami
sudo systemctl status ssh
```

### üìä Surveillance et logs sudo

#### Voir l'historique des commandes sudo

```bash
# Logs dans le journal syst√®me
sudo journalctl | grep sudo

# Logs d√©taill√©s (si configur√©)
sudo tail -f /var/log/sudo.log

# Logs d'authentification
sudo tail -f /var/log/auth.log | grep sudo
```

#### Exemple de log sudo

```
Jan 15 10:30:15 debian marie : TTY=pts/0 ; PWD=/home/marie ;
USER=root ; COMMAND=/usr/bin/apt update
```

**Interpr√©tation** :
- **Qui** : marie
- **Quand** : 15 janvier √† 10h30
- **O√π** : Terminal pts/0
- **Depuis** : Dossier /home/marie
- **Quoi** : Commande apt update en tant que root

---

## 1.3.4 Mise √† jour du syst√®me

### üîÑ Pourquoi mettre √† jour ?

#### Types de mises √† jour

**Mises √† jour de s√©curit√©** üõ°Ô∏è :
- **Priorit√©** : CRITIQUE
- **Fr√©quence** : D√®s que disponibles
- **Exemple** : Correction faille SSH, navigateur web

**Mises √† jour de bugs** üêõ :
- **Priorit√©** : Importante
- **Fr√©quence** : R√©guli√®re (hebdomadaire)
- **Exemple** : Correction plantage application

**Nouvelles fonctionnalit√©s** ‚ú® :
- **Priorit√©** : Optionnelle
- **Fr√©quence** : √Ä votre convenance
- **Exemple** : Nouvelle version LibreOffice

### üì¶ Le syst√®me APT en d√©tail

#### Les commandes essentielles

```bash
# 1. Mettre √† jour la liste des paquets disponibles
sudo apt update
# Lit les d√©p√¥ts, t√©l√©charge les listes de paquets
# Dur√©e : 10-30 secondes

# 2. Voir les mises √† jour disponibles
apt list --upgradable
# Liste tous les paquets qui peuvent √™tre mis √† jour

# 3. Mettre √† jour tous les paquets
sudo apt upgrade
# Met √† jour sans changer les d√©pendances

# 4. Mise √† jour compl√®te (avec nouvelles d√©pendances)
sudo apt full-upgrade
# Peut installer/supprimer des paquets si n√©cessaire
```

#### Comprendre la diff√©rence upgrade vs full-upgrade

**apt upgrade** :
- Met √† jour les paquets existants
- N'installe jamais de nouveaux paquets
- N'en supprime jamais
- **Usage** : Mise √† jour de routine, s√©curis√©e

**apt full-upgrade** :
- Met √† jour les paquets existants
- Peut installer de nouveaux paquets (d√©pendances)
- Peut supprimer des paquets obsol√®tes
- **Usage** : Mise √† jour majeure, plus compl√®te

### üéØ Strat√©gies de mise √† jour

#### Mise √† jour quotidienne simple

```bash
# Routine recommand√©e pour d√©butants
sudo apt update && sudo apt upgrade
```

#### Mise √† jour avec v√©rification

```bash
# Version prudente avec validation
sudo apt update
apt list --upgradable
# Examiner la liste
sudo apt upgrade
```

#### Automatisation des mises √† jour de s√©curit√©

```bash
# Installer le paquet de mise √† jour automatique
sudo apt install unattended-upgrades

# Configurer pour les mises √† jour de s√©curit√© seulement
sudo dpkg-reconfigure unattended-upgrades
# R√©pondre "Oui" pour activer

# V√©rifier la configuration
cat /etc/apt/apt.conf.d/20auto-upgrades
```

### üßπ Nettoyage du syst√®me

#### Supprimer les paquets inutiles

```bash
# Supprimer les paquets orphelins
sudo apt autoremove
# Supprime les paquets install√©s automatiquement mais plus n√©cessaires

# Nettoyer le cache des paquets t√©l√©charg√©s
sudo apt autoclean
# Supprime les anciens fichiers .deb du cache

# Nettoyage complet du cache
sudo apt clean
# Supprime TOUS les fichiers .deb du cache
```

#### Voir l'espace lib√©r√©

```bash
# Avant nettoyage
df -h /var/cache/apt/archives/

# Apr√®s nettoyage
sudo apt clean
df -h /var/cache/apt/archives/

# Voir l'espace total utilis√© par apt
du -sh /var/cache/apt/archives/
```

### üîç Gestion avanc√©e des paquets

#### Rechercher des paquets

```bash
# Rechercher par nom
apt search firefox

# Rechercher par description
apt search "text editor"

# Informations d√©taill√©es sur un paquet
apt show firefox-esr

# Voir les d√©pendances d'un paquet
apt depends firefox-esr
```

#### Installer/supprimer des paquets

```bash
# Installer un paquet
sudo apt install nom-du-paquet

# Installer plusieurs paquets
sudo apt install paquet1 paquet2 paquet3

# Supprimer un paquet (garder configuration)
sudo apt remove nom-du-paquet

# Supprimer compl√®tement (avec configuration)
sudo apt purge nom-du-paquet
```

### üìÖ Planification des mises √† jour

#### Cr√©er une routine hebdomadaire

```bash
# Cr√©er un script de mise √† jour
sudo nano /usr/local/bin/weekly-update.sh

#!/bin/bash
# Script de mise √† jour hebdomadaire
echo "=== Mise √† jour du syst√®me $(date) ==="
apt update
echo "Paquets √† mettre √† jour :"
apt list --upgradable
echo "D√©but de la mise √† jour..."
apt upgrade -y
apt autoremove -y
apt autoclean
echo "=== Mise √† jour termin√©e ==="

# Rendre le script ex√©cutable
sudo chmod +x /usr/local/bin/weekly-update.sh

# Tester le script
sudo /usr/local/bin/weekly-update.sh
```

---

## üß™ Lab : Configuration post-installation

### üéØ Objectif du lab

Appliquer tous les concepts de post-installation sur votre syst√®me Debian fra√Æchement install√©, en suivant les meilleures pratiques de s√©curit√© et d'administration.

### üìã Pr√©requis

- Syst√®me Debian 12 install√© et fonctionnel
- Acc√®s administrateur (sudo ou root)
- Connexion Internet stable
- Terminal accessible

### üîß Partie 1 : Configuration syst√®me initiale (30 min)

#### √âtape 1 : Diagnostic complet du syst√®me

```bash
# Cr√©er un rapport de syst√®me initial
echo "=== RAPPORT SYST√àME INITIAL ===" > ~/rapport-systeme.txt
echo "Date: $(date)" >> ~/rapport-systeme.txt
echo "" >> ~/rapport-systeme.txt

# Informations syst√®me
echo "=== SYST√àME ===" >> ~/rapport-systeme.txt
hostnamectl >> ~/rapport-systeme.txt
echo "" >> ~/rapport-systeme.txt

# Espace disque
echo "=== ESPACE DISQUE ===" >> ~/rapport-systeme.txt
df -h >> ~/rapport-systeme.txt
echo "" >> ~/rapport-systeme.txt

# M√©moire
echo "=== M√âMOIRE ===" >> ~/rapport-systeme.txt
free -h >> ~/rapport-systeme.txt
echo "" >> ~/rapport-systeme.txt

# R√©seau
echo "=== R√âSEAU ===" >> ~/rapport-systeme.txt
ip addr show >> ~/rapport-systeme.txt
echo "" >> ~/rapport-systeme.txt

# Afficher le rapport
cat ~/rapport-systeme.txt
```

#### √âtape 2 : Configuration de l'heure et localisation

```bash
# V√©rifier et configurer le fuseau horaire
timedatectl

# Si n√©cessaire, changer pour votre r√©gion
sudo timedatectl set-timezone Europe/Paris

# Activer la synchronisation NTP
sudo timedatectl set-ntp true

# V√©rifier la configuration locale
locale

# Reconfigurer les locales si n√©cessaire
sudo dpkg-reconfigure locales
```

#### √âtape 3 : Optimisation affichage et interface

```bash
# Via interface graphique :
# 1. Ouvrir Param√®tres
# 2. Affichage ‚Üí Ajuster r√©solution
# 3. R√©gion et langue ‚Üí V√©rifier formats

# Installer des polices suppl√©mentaires
sudo apt update
sudo apt install fonts-liberation fonts-dejavu-extra fonts-noto

# V√©rifier l'installation
fc-list | grep -i liberation
```

### üë• Partie 2 : Gestion des utilisateurs (45 min)

#### √âtape 1 : Analyser les utilisateurs existants

```bash
# Cr√©er un script d'analyse des utilisateurs
cat << 'EOF' > ~/analyser-utilisateurs.sh
#!/bin/bash
echo "=== ANALYSE DES UTILISATEURS ==="
echo "Utilisateurs humains (UID >= 1000) :"
awk -F: '$3 >= 1000 && $1 != "nobody" {print $1 " (UID: " $3 ")"}' /etc/passwd

echo -e "\nGroupes de votre utilisateur :"
groups $(whoami)

echo -e "\nMembres du groupe sudo :"
getent group sudo
EOF

chmod +x ~/analyser-utilisateurs.sh
./analyser-utilisateurs.sh
```

#### √âtape 2 : Cr√©er un utilisateur de test

```bash
# Cr√©er un utilisateur "testuser"
sudo adduser testuser
# Suivre l'assistant (mot de passe : test123)

# V√©rifier la cr√©ation
ls -la /home/
cat /etc/passwd | grep testuser

# Voir les groupes par d√©faut
groups testuser
```

#### √âtape 3 : Exp√©rimenter avec les groupes

```bash
# Cr√©er un groupe personnalis√©
sudo groupadd projet-web

# Ajouter testuser √† diff√©rents groupes
sudo usermod -aG projet-web testuser
sudo usermod -aG audio testuser

# V√©rifier les modifications
groups testuser

# Tester la connexion du nouvel utilisateur
# (Dans un nouveau terminal ou console)
su - testuser
# Mot de passe : test123
whoami
groups
exit
```

#### √âtape 4 : S√©curiser les mots de passe

```bash
# Voir la politique de mots de passe
sudo cat /etc/login.defs | grep PASS

# Changer son propre mot de passe
passwd
# Suivre les recommandations de s√©curit√©

# Forcer testuser √† changer son mot de passe
sudo passwd -e testuser
```

### üîê Partie 3 : Configuration sudo avanc√©e (30 min)

#### √âtape 1 : Analyser la configuration sudo actuelle

```bash
# V√©rifier vos droits sudo
sudo -l

# Voir la configuration compl√®te
sudo cat /etc/sudoers
```

#### √âtape 2 : Cr√©er une configuration sudo personnalis√©e

```bash
# √âditer la configuration sudo
sudo visudo

# Ajouter √† la fin du fichier :
# Groupe pour les d√©veloppeurs web
%projet-web ALL=(ALL) /usr/bin/systemctl reload apache2, /usr/bin/systemctl status apache2

# Utilisateur testuser avec commandes limit√©es
testuser ALL=(ALL) /usr/bin/apt update, /usr/bin/apt upgrade, /bin/systemctl status *

# Sauvegarder et quitter (Ctrl+X, Y, Entr√©e)
```

#### √âtape 3 : Tester la configuration sudo

```bash
# V√©rifier la syntaxe
sudo visudo -c

# Tester avec testuser (nouveau terminal)
su - testuser

# Tests autoris√©s
sudo apt update
sudo systemctl status ssh

# Tests interdits (devraient √©chouer)
sudo systemctl restart ssh  # Pas autoris√©
sudo cat /etc/shadow  # Pas autoris√©

exit
```

#### √âtape 4 : Configurer les logs sudo

```bash
# √âditer √† nouveau visudo
sudo visudo

# Ajouter ces lignes au d√©but des Defaults :
Defaults logfile="/var/log/sudo.log"
Defaults log_input, log_output

# Sauvegarder
```

### üîÑ Partie 4 : Gestion des mises √† jour (30 min)

#### √âtape 1 : Mise √† jour compl√®te du syst√®me

```bash
# Cr√©er un script de mise √† jour avec logs
cat << 'EOF' > ~/mise-a-jour-complete.sh
#!/bin/bash
LOGFILE="/tmp/update-$(date +%Y%m%d-%H%M).log"

echo "=== D√âBUT MISE √Ä JOUR $(date) ===" | tee $LOGFILE

# Mise √† jour des listes
echo "Mise √† jour des listes de paquets..." | tee -a $LOGFILE
sudo apt update | tee -a $LOGFILE

# Voir les mises √† jour disponibles
echo -e "\nMises √† jour disponibles :" | tee -a $LOGFILE
apt list --upgradable | tee -a $LOGFILE

# Mise √† jour des paquets
echo -e "\nMise √† jour des paquets..." | tee -a $LOGFILE
sudo apt upgrade -y | tee -a $LOGFILE

# Nettoyage
echo -e "\nNettoyage du syst√®me..." | tee -a $LOGFILE
sudo apt autoremove -y | tee -a $LOGFILE
sudo apt autoclean | tee -a $LOGFILE

echo -e "\n=== FIN MISE √Ä JOUR $(date) ===" | tee -a $LOGFILE
echo "Log sauvegard√© dans : $LOGFILE"
EOF

chmod +x ~/mise-a-jour-complete.sh
./mise-a-jour-complete.sh
```

#### √âtape 2 : Configurer les mises √† jour automatiques

```bash
# Installer unattended-upgrades
sudo apt install unattended-upgrades apt-listchanges

# Configurer
sudo dpkg-reconfigure unattended-upgrades
# R√©pondre "Oui"

# V√©rifier la configuration
cat /etc/apt/apt.conf.d/20auto-upgrades

# Personnaliser (optionnel)
sudo nano /etc/apt/apt.conf.d/50unattended-upgrades
```

#### √âtape 3 : Surveiller les mises √† jour

```bash
# Voir les logs de mise √† jour automatique
sudo cat /var/log/unattended-upgrades/unattended-upgrades.log

# Cr√©er un script de monitoring
cat << 'EOF' > ~/check-updates.sh
#!/bin/bash
echo "=== √âTAT DES MISES √Ä JOUR ==="
echo "Derni√®re mise √† jour des listes : $(stat -c %y /var/lib/apt/lists/)"
echo "Paquets √† mettre √† jour :"
apt list --upgradable 2>/dev/null | grep -v "WARNING" | wc -l
echo "Espace utilis√© par le cache :"
du -sh /var/cache/apt/archives/
EOF

chmod +x ~/check-updates.sh
./~/check-updates.sh
```

### üõ†Ô∏è Partie 5 : Installation d'outils essentiels (30 min)

#### √âtape 1 : Outils syst√®me de base

```bash
# Installer les outils essentiels
sudo apt update
sudo apt install -y \
  curl \
  wget \
  git \
  vim \
  nano \
  tree \
  htop \
  neofetch \
  build-essential

# Tester les installations
curl --version
git --version
tree --version
```

#### √âtape 2 : Outils de monitoring

```bash
# Installer des outils de surveillance
sudo apt install -y \
  netstat-nat \
  lsof \
  iotop \
  nmon

# Tester htop
htop
# Appuyer sur 'q' pour quitter

# Tester neofetch
neofetch

# Cr√©er un script de diagnostic syst√®me
cat << 'EOF' > ~/diagnostic-systeme.sh
#!/bin/bash
echo "=== DIAGNOSTIC SYST√àME COMPLET ==="
echo "Date: $(date)"
echo ""

echo "=== INFORMATIONS G√âN√âRALES ==="
neofetch --stdout

echo -e "\n=== UTILISATION CPU/M√âMOIRE ==="
echo "Load average: $(uptime | awk -F'load average:' '{print $2}')"
echo "M√©moire:"
free -h

echo -e "\n=== ESPACE DISQUE ==="
df -h | grep -E '^/dev|Filesystem'

echo -e "\n=== PROCESSUS CONSOMMATEURS ==="
echo "Top 5 processus CPU:"
ps aux --sort=-%cpu | head -6

echo -e "\nTop 5 processus m√©moire:"
ps aux --sort=-%mem | head -6

echo -e "\n=== R√âSEAU ==="
echo "Connexions actives:"
netstat -tuln | grep LISTEN | head -10

echo -e "\n=== SERVICES ACTIFS ==="
systemctl list-units --type=service --state=active | head -10
EOF

chmod +x ~/diagnostic-systeme.sh
./diagnostic-systeme.sh
```

#### √âtape 3 : Configuration des outils de d√©veloppement

```bash
# Installer un environnement de d√©veloppement de base
sudo apt install -y \
  python3 \
  python3-pip \
  nodejs \
  npm \
  default-jdk

# V√©rifier les installations
python3 --version
node --version
java -version

# Configurer Git (remplacer par vos informations)
git config --global user.name "Votre Nom"
git config --global user.email "votre.email@example.com"

# V√©rifier la configuration Git
git config --list | grep user
```

### üîí Partie 6 : S√©curisation de base (45 min)

#### √âtape 1 : Configuration du pare-feu

```bash
# Installer UFW (Uncomplicated Firewall)
sudo apt install ufw

# V√©rifier l'√©tat initial
sudo ufw status

# Configuration de base
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Autoriser SSH (important pour ne pas se bloquer!)
sudo ufw allow ssh

# Autoriser d'autres services selon besoins
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS

# Activer le pare-feu
sudo ufw enable

# V√©rifier la configuration
sudo ufw status verbose
```

#### √âtape 2 : Configuration SSH s√©curis√©e

```bash
# Sauvegarder la configuration SSH originale
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# √âditer la configuration SSH
sudo nano /etc/ssh/sshd_config

# Modifications recommand√©es :
# Port 2222                          # Changer le port par d√©faut
# PermitRootLogin no                  # Interdire la connexion root directe
# PasswordAuthentication yes          # Garder pour l'instant
# PubkeyAuthentication yes            # Activer l'auth par cl√©s
# MaxAuthTries 3                      # Limiter les tentatives
# ClientAliveInterval 300             # Timeout de session
# ClientAliveCountMax 2               # Nb de timeouts avant d√©connexion

# Tester la configuration
sudo sshd -t

# Red√©marrer SSH
sudo systemctl restart ssh

# Mettre √† jour le pare-feu pour le nouveau port
sudo ufw delete allow ssh
sudo ufw allow 2222/tcp

# Tester la connexion (dans un nouveau terminal)
ssh -p 2222 $(whoami)@localhost
```

#### √âtape 3 : Installation et configuration de fail2ban

```bash
# Installer fail2ban
sudo apt install fail2ban

# Cr√©er une configuration personnalis√©e
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

# √âditer la configuration
sudo nano /etc/fail2ban/jail.local

# Modifier les sections :
# [DEFAULT]
# bantime = 3600         # Bannir pour 1h
# findtime = 600         # Fen√™tre de d√©tection 10min
# maxretry = 3           # 3 tentatives max
#
# [sshd]
# enabled = true
# port = 2222            # Votre port SSH personnalis√©

# Red√©marrer fail2ban
sudo systemctl restart fail2ban
sudo systemctl enable fail2ban

# V√©rifier le statut
sudo fail2ban-client status
sudo fail2ban-client status sshd
```

#### √âtape 4 : Configuration des mises √† jour de s√©curit√©

```bash
# V√©rifier que unattended-upgrades est bien configur√©
cat /etc/apt/apt.conf.d/50unattended-upgrades | grep -A5 -B5 "security"

# Configurer les notifications par email (optionnel)
sudo nano /etc/apt/apt.conf.d/50unattended-upgrades
# D√©commenter et modifier :
# Unattended-Upgrade::Mail "votre-email@example.com";

# V√©rifier les logs
sudo cat /var/log/unattended-upgrades/unattended-upgrades.log | tail -20
```

### üìä Partie 7 : Monitoring et maintenance (30 min)

#### √âtape 1 : Scripts de maintenance automatique

```bash
# Cr√©er un script de maintenance hebdomadaire
sudo mkdir -p /usr/local/scripts

sudo cat << 'EOF' > /usr/local/scripts/maintenance-hebdo.sh
#!/bin/bash
# Script de maintenance hebdomadaire
LOGFILE="/var/log/maintenance-$(date +%Y%m%d).log"

echo "=== MAINTENANCE HEBDOMADAIRE $(date) ===" | tee $LOGFILE

# Mise √† jour du syst√®me
echo "1. Mise √† jour du syst√®me..." | tee -a $LOGFILE
apt update | tee -a $LOGFILE
apt upgrade -y | tee -a $LOGFILE

# Nettoyage
echo "2. Nettoyage du syst√®me..." | tee -a $LOGFILE
apt autoremove -y | tee -a $LOGFILE
apt autoclean | tee -a $LOGFILE

# V√©rification espace disque
echo "3. V√©rification espace disque..." | tee -a $LOGFILE
df -h | tee -a $LOGFILE

# Nettoyage logs anciens
echo "4. Nettoyage logs anciens..." | tee -a $LOGFILE
journalctl --vacuum-time=30d | tee -a $LOGFILE

# V√©rification services
echo "5. V√©rification services critiques..." | tee -a $LOGFILE
systemctl is-active ssh ufw fail2ban | tee -a $LOGFILE

echo "=== MAINTENANCE TERMIN√âE $(date) ===" | tee -a $LOGFILE
EOF

sudo chmod +x /usr/local/scripts/maintenance-hebdo.sh

# Tester le script
sudo /usr/local/scripts/maintenance-hebdo.sh
```

#### √âtape 2 : Configuration des t√¢ches cron

```bash
# √âditer la crontab root pour les t√¢ches syst√®me
sudo crontab -e

# Ajouter ces lignes :
# Maintenance hebdomadaire le dimanche √† 3h
0 3 * * 0 /usr/local/scripts/maintenance-hebdo.sh

# Sauvegarde des configurations importantes quotidiennement
0 2 * * * tar -czf /backup/config-$(date +\%Y\%m\%d).tar.gz /etc/ssh/ /etc/sudoers /etc/fail2ban/ /etc/ufw/ 2>/dev/null

# V√©rifier les t√¢ches cron
sudo crontab -l

# Cr√©er le dossier de sauvegarde
sudo mkdir -p /backup
sudo chmod 700 /backup
```

#### √âtape 3 : Monitoring des logs syst√®me

```bash
# Cr√©er un script de surveillance des logs
cat << 'EOF' > ~/surveiller-logs.sh
#!/bin/bash
echo "=== SURVEILLANCE DES LOGS ==="

echo "Derni√®res tentatives de connexion SSH √©chou√©es:"
sudo grep "Failed password" /var/log/auth.log | tail -5

echo -e "\nBannissements fail2ban r√©cents:"
sudo grep "Ban " /var/log/fail2ban.log | tail -5

echo -e "\nErreurs syst√®me r√©centes:"
sudo journalctl -p err --since "1 hour ago" --no-pager

echo -e "\nEspace disque critique (>90%):"
df -h | awk '$5 > 90 {print $0}'

echo -e "\nProcessus consommant le plus de m√©moire:"
ps aux --sort=-%mem | head -5
EOF

chmod +x ~/surveiller-logs.sh
./surveiller-logs.sh
```

### üß™ Partie 8 : Tests de validation (30 min)

#### √âtape 1 : Tests de s√©curit√©

```bash
# Cr√©er un script de tests de s√©curit√©
cat << 'EOF' > ~/tests-securite.sh
#!/bin/bash
echo "=== TESTS DE S√âCURIT√â ==="

echo "1. Test connexion SSH root (doit √©chouer):"
timeout 10 ssh -p 2222 -o ConnectTimeout=5 root@localhost 2>&1 | grep -E "(denied|refused)" && echo "‚úÖ Root SSH d√©sactiv√©" || echo "‚ùå Root SSH autoris√©"

echo -e "\n2. Test pare-feu actif:"
sudo ufw status | grep -q "Status: active" && echo "‚úÖ UFW actif" || echo "‚ùå UFW inactif"

echo -e "\n3. Test fail2ban actif:"
sudo systemctl is-active fail2ban | grep -q "active" && echo "‚úÖ Fail2ban actif" || echo "‚ùå Fail2ban inactif"

echo -e "\n4. Test mises √† jour auto activ√©es:"
grep -q "1" /etc/apt/apt.conf.d/20auto-upgrades && echo "‚úÖ Mises √† jour auto activ√©es" || echo "‚ùå Mises √† jour auto d√©sactiv√©es"

echo -e "\n5. Test permissions sudo restrictives:"
sudo -l | grep -q "ALL" && echo "‚ö†Ô∏è  Droits sudo larges" || echo "‚úÖ Droits sudo restreints"

echo -e "\n6. Test services non essentiels:"
SERVICES_SUSPECTS=("telnet" "rsh" "ftp")
for service in "${SERVICES_SUSPECTS[@]}"; do
    if systemctl is-active $service 2>/dev/null | grep -q "active"; then
        echo "‚ùå Service non s√©curis√© actif: $service"
    else
        echo "‚úÖ Service $service inactif"
    fi
done
EOF

chmod +x ~/tests-securite.sh
./tests-securite.sh
```

#### √âtape 2 : Tests de fonctionnalit√©

```bash
# Cr√©er un script de tests fonctionnels
cat << 'EOF' > ~/tests-fonctionnalite.sh
#!/bin/bash
echo "=== TESTS DE FONCTIONNALIT√â ==="

echo "1. Test connectivit√© Internet:"
ping -c 3 8.8.8.8 >/dev/null 2>&1 && echo "‚úÖ Connectivit√© IP OK" || echo "‚ùå Pas de connectivit√© IP"
ping -c 3 google.com >/dev/null 2>&1 && echo "‚úÖ R√©solution DNS OK" || echo "‚ùå Probl√®me DNS"

echo -e "\n2. Test services essentiels:"
SERVICES=("ssh" "cron" "systemd-resolved")
for service in "${SERVICES[@]}"; do
    if systemctl is-active $service >/dev/null 2>&1; then
        echo "‚úÖ $service actif"
    else
        echo "‚ùå $service inactif"
    fi
done

echo -e "\n3. Test espace disque:"
USAGE=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $USAGE -lt 80 ]; then
    echo "‚úÖ Espace disque OK ($USAGE%)"
else
    echo "‚ö†Ô∏è  Espace disque critique ($USAGE%)"
fi

echo -e "\n4. Test performance syst√®me:"
LOAD=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')
echo "Load average: $LOAD"

echo -e "\n5. Test outils install√©s:"
OUTILS=("git" "curl" "htop" "vim")
for outil in "${OUTILS[@]}"; do
    if command -v $outil >/dev/null 2>&1; then
        echo "‚úÖ $outil install√©"
    else
        echo "‚ùå $outil manquant"
    fi
done
EOF

chmod +x ~/tests-fonctionnalite.sh
./tests-fonctionnalite.sh
```

#### √âtape 3 : G√©n√©ration du rapport final

```bash
# Cr√©er un rapport complet de configuration
cat << 'EOF' > ~/generer-rapport-final.sh
#!/bin/bash
RAPPORT="rapport-final-$(date +%Y%m%d-%H%M).txt"

echo "=== RAPPORT DE CONFIGURATION POST-INSTALLATION ===" > $RAPPORT
echo "G√©n√©r√© le: $(date)" >> $RAPPORT
echo "Syst√®me: $(hostnamectl | grep "Operating System")" >> $RAPPORT
echo "" >> $RAPPORT

echo "=== UTILISATEURS ET GROUPES ===" >> $RAPPORT
echo "Utilisateurs humains:" >> $RAPPORT
awk -F: '$3 >= 1000 && $1 != "nobody" {print "  " $1 " (UID: " $3 ")"}' /etc/passwd >> $RAPPORT
echo "Membres du groupe sudo:" >> $RAPPORT
getent group sudo >> $RAPPORT
echo "" >> $RAPPORT

echo "=== CONFIGURATION R√âSEAU ===" >> $RAPPORT
echo "Interfaces:" >> $RAPPORT
ip addr show | grep -E '^[0-9]|inet ' >> $RAPPORT
echo "" >> $RAPPORT

echo "=== S√âCURIT√â ===" >> $RAPPORT
echo "UFW Status:" >> $RAPPORT
sudo ufw status >> $RAPPORT
echo "SSH Config:" >> $RAPPORT
sudo grep -E '^(Port|PermitRootLogin|PasswordAuthentication)' /etc/ssh/sshd_config >> $RAPPORT
echo "" >> $RAPPORT

echo "=== SERVICES ACTIFS ===" >> $RAPPORT
systemctl list-units --type=service --state=active --no-pager >> $RAPPORT
echo "" >> $RAPPORT

echo "=== ESPACE DISQUE ===" >> $RAPPORT
df -h >> $RAPPORT
echo "" >> $RAPPORT

echo "=== TESTS DE S√âCURIT√â ===" >> $RAPPORT
./tests-securite.sh >> $RAPPORT 2>&1
echo "" >> $RAPPORT

echo "=== TESTS DE FONCTIONNALIT√â ===" >> $RAPPORT
./tests-fonctionnalite.sh >> $RAPPORT 2>&1

echo "Rapport sauvegard√© dans: $RAPPORT"
cat $RAPPORT
EOF

chmod +x ~/generer-rapport-final.sh
./generer-rapport-final.sh
```

---

## ‚úÖ Checklist de validation compl√®te

### üîß Configuration syst√®me

- [ ] **Fuseau horaire** : Configur√© correctement (Europe/Paris)
- [ ] **Synchronisation NTP** : Activ√©e et fonctionnelle
- [ ] **Locales** : Fran√ßais configur√© correctement
- [ ] **Affichage** : R√©solution optimale, polices install√©es
- [ ] **Outils syst√®me** : Tous les outils essentiels install√©s

### üë• Gestion des utilisateurs

- [ ] **Utilisateur principal** : Droits sudo configur√©s
- [ ] **Utilisateur de test** : Cr√©√© avec droits limit√©s
- [ ] **Groupes personnalis√©s** : Cr√©√©s et utilis√©s
- [ ] **Politique de mots de passe** : Renforc√©e
- [ ] **Analyse utilisateurs** : Script fonctionnel

### üîê Configuration sudo

- [ ] **Fichier sudoers** : √âdit√© sans erreur avec visudo
- [ ] **Droits granulaires** : Configur√©s pour utilisateur test
- [ ] **Logs sudo** : Activ√©s et fonctionnels
- [ ] **Tests de permissions** : R√©alis√©s avec succ√®s
- [ ] **S√©curit√© sudo** : Options de s√©curit√© activ√©es

### üîÑ Mises √† jour

- [ ] **Syst√®me √† jour** : Toutes les mises √† jour appliqu√©es
- [ ] **Script de mise √† jour** : Cr√©√© et test√©
- [ ] **Mises √† jour automatiques** : Configur√©es pour s√©curit√©
- [ ] **Nettoyage syst√®me** : Effectu√© et automatis√©
- [ ] **Monitoring mises √† jour** : Script de surveillance cr√©√©

### üîí S√©curisation

- [ ] **Pare-feu UFW** : Configur√© et actif
- [ ] **SSH s√©curis√©** : Port chang√©, root d√©sactiv√©
- [ ] **Fail2ban** : Install√© et configur√©
- [ ] **Services non essentiels** : D√©sactiv√©s
- [ ] **Tests de s√©curit√©** : Tous r√©ussis

### üìä Monitoring et maintenance

- [ ] **Outils de monitoring** : Install√©s et fonctionnels
- [ ] **Scripts de diagnostic** : Cr√©√©s et test√©s
- [ ] **T√¢ches cron** : Configur√©es pour maintenance auto
- [ ] **Surveillance logs** : Script op√©rationnel
- [ ] **Rapport final** : G√©n√©r√© avec succ√®s

---

## üö® Troubleshooting post-installation

### Probl√®me : Sudo ne fonctionne pas

#### Diagnostic
```bash
# V√©rifier l'appartenance au groupe sudo
groups $(whoami)

# V√©rifier la syntaxe du fichier sudoers
sudo visudo -c
```

#### Solutions
```bash
# Se connecter en root
su -

# Ajouter l'utilisateur au groupe sudo
usermod -aG sudo votre-nom

# Ou r√©parer le fichier sudoers
visudo
```

### Probl√®me : SSH refuse les connexions

#### Diagnostic
```bash
# V√©rifier que SSH est actif
sudo systemctl status ssh

# V√©rifier la configuration
sudo sshd -t

# V√©rifier le pare-feu
sudo ufw status
```

#### Solutions
```bash
# Red√©marrer SSH
sudo systemctl restart ssh

# Ouvrir le port dans UFW
sudo ufw allow 2222/tcp

# V√©rifier les logs
sudo journalctl -u ssh
```

### Probl√®me : Mises √† jour √©chouent

#### Diagnostic
```bash
# V√©rifier les sources APT
cat /etc/apt/sources.list

# Tester la connectivit√©
ping debian.org

# V√©rifier l'espace disque
df -h
```

#### Solutions
```bash
# Nettoyer le cache APT
sudo apt clean

# Reconfigurer les sources
sudo dpkg-reconfigure apt

# Lib√©rer de l'espace
sudo apt autoremove
sudo apt autoclean
```

---

## üéâ F√©licitations !

### Ce que vous avez accompli

üéØ **Configuration compl√®te** : Syst√®me Debian optimis√© et s√©curis√©
üë• **Gestion utilisateurs** : Ma√Ætrise des comptes et permissions
üîê **S√©curisation avanc√©e** : Pare-feu, SSH, fail2ban configur√©s
üîÑ **Maintenance automatis√©e** : Scripts et t√¢ches cron op√©rationnels
üìä **Monitoring** : Outils de surveillance et diagnostic en place

### Comp√©tences acquises

‚úÖ **Administration syst√®me** : Concepts fondamentaux ma√Ætris√©s
‚úÖ **S√©curit√© de base** : Bonnes pratiques appliqu√©es
‚úÖ **Automatisation** : Scripts de maintenance cr√©√©s
‚úÖ **D√©pannage** : M√©thodes de diagnostic apprises
‚úÖ **Documentation** : Rapports et logs structur√©s

### Prochaines √©tapes recommand√©es

1. **Pratique r√©guli√®re** : Utilisez quotidiennement votre syst√®me
2. **Veille s√©curit√©** : Surveillez les alertes de s√©curit√© Debian
3. **Sauvegarde** : Mettez en place une strat√©gie de sauvegarde
4. **Approfondissement** : Explorez les modules suivants de la formation
5. **Documentation** : Tenez √† jour vos proc√©dures personnelles

### Ressources pour aller plus loin

- **Debian Security** : https://www.debian.org/security/
- **Guide administrateur** : https://debian-handbook.info/
- **Forums communaut√©** : https://debian-facile.org/
- **Documentation sudo** : https://www.sudo.ws/docs/

---

## üìù Notes personnelles de configuration

*Espace pour vos observations et personnalisations :*

**Configurations sp√©cifiques appliqu√©es** :
- Port SSH utilis√© : ___________
- Utilisateurs cr√©√©s : ___________
- Groupes personnalis√©s : ___________

**Scripts personnalis√©s** :
- Localisation des scripts : ___________
- Modifications apport√©es : ___________
- T√¢ches cron configur√©es : ___________

**Points √† retenir** :
- Commandes les plus utiles : ___________
- Probl√®mes rencontr√©s et solutions : ___________
- Am√©liorations √† apporter : ___________

---

*üí° **Conseil final** : Votre syst√®me Debian est maintenant solidement configur√© et s√©curis√©. Prenez l'habitude de consulter r√©guli√®rement vos scripts de monitoring et de tenir √† jour votre documentation. Cette base solide vous permettra d'aborder sereinement les modules plus avanc√©s de la formation.*

**üéØ Pr√™t pour le Module 2 : Debian Desktop !**
