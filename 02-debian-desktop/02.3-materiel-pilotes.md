🔝 Retour au [Sommaire](/SOMMAIRE.md)

# 2.3 Matériel et pilotes

## 2.3.1 Installation de pilotes propriétaires (NVIDIA, WiFi)

### Comprendre les pilotes sous Linux

#### Pilotes libres vs propriétaires

**Pilotes libres (Open Source) :**
- ✅ **Inclus** dans le kernel Linux par défaut
- ✅ **Sécurité** : Code source ouvert et auditable
- ✅ **Stabilité** : Intégrés et testés avec le système
- ✅ **Maintenance** : Mis à jour avec le système
- ❌ **Performance** : Parfois limitées (graphisme 3D)

**Pilotes propriétaires (Closed Source) :**
- ✅ **Performance** : Optimisations complètes du fabricant
- ✅ **Fonctionnalités** : Accès à toutes les capacités matériel
- ❌ **Sécurité** : Code fermé, pas d'audit possible
- ❌ **Stabilité** : Peuvent causer conflits système
- ❌ **Dépendance** : Liés aux versions spécifiques

#### Identification du matériel

**Commandes de diagnostic essentielles :**
```bash
# Informations générales matériel
sudo lshw -short

# Cartes graphiques
lspci | grep -i vga
lspci | grep -i display

# Cartes réseau WiFi
lspci | grep -i network
lspci | grep -i wireless

# Périphériques USB
lsusb

# Informations CPU détaillées
lscpu
lshw -class processor
```

**Vérification pilotes actuels :**
```bash
# Pilotes graphiques chargés
lsmod | grep -E "(nvidia|nouveau|radeon|amdgpu|i915)"

# Pilotes réseau
lsmod | grep -E "(iwl|rtl|ath|brcm)"
```

### Installation pilotes NVIDIA

#### Méthode 1 : Dépôts officiels Debian (Recommandée ✅)

**Détection carte NVIDIA :**
```bash
# Identifier modèle exact
lspci | grep -i nvidia

# Exemple de sortie :
# 01:00.0 VGA compatible controller: NVIDIA Corporation GeForce GTX 1060
```

**Activation dépôt non-free :**
```bash
# Éditer sources.list
sudo nano /etc/apt/sources.list

# Ajouter "contrib non-free" à chaque ligne, exemple :
# deb http://deb.debian.org/debian bookworm main contrib non-free
# deb http://security.debian.org/debian-security bookworm-security main contrib non-free

# Mise à jour des sources
sudo apt update
```

**Installation pilote NVIDIA :**
```bash
# Recherche versions disponibles
apt search nvidia-driver

# Installation pilote recommandé
sudo apt install nvidia-driver

# Ou version spécifique si nécessaire
sudo apt install nvidia-driver-525  # Exemple version

# Redémarrage obligatoire
sudo reboot
```

#### Méthode 2 : Auto-détection

**Outil automatique :**
```bash
# Installation outil détection
sudo apt install nvidia-detect

# Exécution détection
nvidia-detect

# Exemple sortie :
# "Your card is supported by the default nvidia-driver package."
```

#### Configuration NVIDIA

**Outils de configuration :**
```bash
# Interface graphique NVIDIA
sudo apt install nvidia-settings

# Lancement
nvidia-settings
```

**Interface NVIDIA Settings :**
```
┌─────────────────────────────────────────────────────┐
│ X Server Display Configuration                      │
├─────────────────────────────────────────────────────┤
│ [Monitor 1] [Monitor 2]                            │
│                                                     │
│ Resolution: 1920x1080 @60Hz ▼                      │
│ Position: [●] Primary Display                       │
│ Rotation: None ▼                                    │
│                                                     │
│ [Apply] [Save to X Configuration File]             │
└─────────────────────────────────────────────────────┘
```

**Configuration courante :**
- **GPU Performance** : Mode performance ou économie
- **Multi-écrans** : Configuration affichage étendu
- **Overclocking** : Ajustement fréquences (attention !)
- **Température** : Surveillance surchauffe

#### Vérification installation NVIDIA

**Tests de fonctionnement :**
```bash
# Version pilote installé
nvidia-smi

# Test OpenGL
glxinfo | grep "OpenGL renderer"
# Doit afficher le nom de votre carte NVIDIA

# Test performance 3D (installation mesa-utils)
sudo apt install mesa-utils
glxgears  # Affiche FPS de rendu 3D
```

#### Résolution problèmes NVIDIA

**Problèmes courants :**

**Écran noir après installation :**
```bash
# Mode recovery : Ctrl+Alt+F2
# Connexion en mode texte
sudo systemctl set-default multi-user.target
sudo reboot

# Désinstallation pilote si problème
sudo apt remove nvidia-driver
sudo apt autoremove

# Réinstallation pilotes libres
sudo apt install xserver-xorg-video-nouveau
```

**Conflit nouveau/nvidia :**
```bash
# Blacklister pilote libre conflictuel
echo "blacklist nouveau" | sudo tee -a /etc/modprobe.d/blacklist-nvidia-nouveau.conf
echo "options nouveau modeset=0" | sudo tee -a /etc/modprobe.d/blacklist-nvidia-nouveau.conf

# Régénérer initramfs
sudo update-initramfs -u
sudo reboot
```

### Installation pilotes WiFi

#### Identification carte WiFi

**Détection matériel :**
```bash
# Carte WiFi installée
lspci | grep -i wireless
lspci | grep -i network

# Interface réseau détectée
ip link show
iwconfig  # Si wireless-tools installé

# Statut interface
rfkill list  # Vérifier si WiFi bloqué
```

#### Pilotes WiFi courants

**Principales marques et pilotes :**

| Fabricant | Série | Paquet firmware | Statut |
|-----------|-------|-----------------|--------|
| **Intel** | iwlwifi | firmware-iwlwifi | ✅ Excellent |
| **Realtek** | RTL8xxx | firmware-realtek | ✅ Très bon |
| **Atheros** | ath9k/ath10k | firmware-atheros | ✅ Bon |
| **Broadcom** | brcm | firmware-brcm80211 | ⚠️ Variable |
| **Ralink** | rt2x00 | firmware-ralink | ✅ Correct |

#### Installation firmware WiFi

**Méthode générale :**
```bash
# Activation dépôts non-free (si pas fait)
sudo nano /etc/apt/sources.list
# Ajouter "non-free" à chaque ligne

sudo apt update

# Installation firmware complet
sudo apt install firmware-linux-nonfree

# Ou firmware spécifique
sudo apt install firmware-iwlwifi      # Intel
sudo apt install firmware-realtek      # Realtek
sudo apt install firmware-atheros      # Atheros
sudo apt install firmware-brcm80211    # Broadcom
```

**Redémarrage services :**
```bash
# Redémarrer gestionnaire réseau
sudo systemctl restart NetworkManager

# Ou recharger module WiFi
sudo modprobe -r iwlwifi  # Exemple Intel
sudo modprobe iwlwifi

# Vérification détection
dmesg | grep -i firmware
dmesg | grep -i wireless
```

#### Configuration NetworkManager

**Interface graphique :**
- **GNOME** : Paramètres → WiFi
- **KDE** : System Settings → Network → WiFi
- **Icône réseau** : Clic sur icône barre système

**Ligne de commande :**
```bash
# Scanner réseaux disponibles
sudo iwlist scan | grep ESSID

# Via NetworkManager
nmcli device wifi list

# Connexion réseau
nmcli device wifi connect "NomRéseau" password "MotDePasse"

# Statut connexion
nmcli connection show
```

#### Cas spéciaux WiFi

**Cartes USB WiFi :**
```bash
# Détection périphérique USB
lsusb | grep -i wireless

# Certaines nécessitent compilation pilote
# Vérifier documentation fabricant
```

**WiFi 6 et récent :**
- **Kernel récent** : Parfois nécessite kernel backport
- **Firmware beta** : Peut nécessiter versions non-officielles
- **Compatibilité** : Vérifier support Linux avant achat

### Autres pilotes propriétaires courants

#### Pilotes AMD/ATI

**Pilotes libres (recommandés) :**
```bash
# Généralement pré-installés
sudo apt install xserver-xorg-video-amdgpu  # Cartes récentes
sudo apt install xserver-xorg-video-radeon  # Cartes anciennes

# Firmware
sudo apt install firmware-amd-graphics
```

**Pilotes propriétaires AMD :**
- **AMDGPU-PRO** : Téléchargement site AMD
- **Usage** : Calcul professionnel, OpenCL
- **Desktop** : Pilotes libres suffisants généralement

#### Pilotes Audio

**Généralement automatiques :**
```bash
# Vérification audio détecté
aplay -l
lspci | grep -i audio

# Firmware audio (rare)
sudo apt install firmware-sof-signed  # Sound Open Firmware
```

#### Périphériques spécialisés

**Imprimantes :**
```bash
# Pilotes génériques
sudo apt install cups-driver-gutenprint

# HP spécifique
sudo apt install hplip

# Canon/Epson : Téléchargement site fabricant
```

**Tablettes graphiques Wacom :**
```bash
# Support natif excellent
sudo apt install xserver-xorg-input-wacom

# Configuration
sudo apt install kde-config-tablet  # KDE
# Ou GNOME Settings → Wacom Tablet
```

## 2.3.2 Gestion de l'alimentation et suspend/hibernate

### Comprendre la gestion d'alimentation

#### Modes d'alimentation Linux

**États ACPI (Advanced Configuration and Power Interface) :**

| État | Nom | Description | Consommation | Réveil |
|------|-----|-------------|--------------|--------|
| **S0** | Working | Fonctionnement normal | 100% | Immédiat |
| **S1** | Sleep | CPU arrêté, RAM alimentée | ~80% | Rapide |
| **S3** | Suspend | RAM seule alimentée | ~5% | 1-3 sec |
| **S4** | Hibernate | Sauvegarde sur disque | 0% | 10-30 sec |
| **S5** | Shutdown | Arrêt complet | 0% | Boot complet |

#### SystemD et gestion alimentation

**Services SystemD impliqués :**
- **systemd-logind** : Gestion sessions utilisateur
- **systemd-sleep** : Gestion suspend/hibernate
- **power-profiles-daemon** : Profils d'alimentation
- **TLP** : Optimisation batterie laptops (optionnel)

### Configuration Suspend (Mise en veille)

#### Activation et test

**Vérification support suspend :**
```bash
# Test si suspend supporté
sudo systemctl suspend

# Réveil : Appuyer sur bouton power ou clavier
```

**Configuration automatique :**
```bash
# Éditer configuration logind
sudo nano /etc/systemd/logind.conf

# Paramètres importants :
HandlePowerKey=suspend          # Bouton power = suspend
HandleLidSwitch=suspend         # Fermeture laptop = suspend
HandleLidSwitchDocked=ignore    # Pas de suspend si dock
IdleAction=suspend              # Action si inactivité
IdleActionSec=20min             # Délai inactivité
```

**Redémarrage service :**
```bash
sudo systemctl restart systemd-logind
```

#### Configuration graphique

**GNOME Settings :**
1. **Paramètres** → Alimentation
2. **Options disponibles** :
   - **Écran** : Extinction automatique (1-15 min)
   - **Suspension automatique** : Sur secteur/batterie
   - **Bouton d'alimentation** : Action personnalisée
   - **Économiseur d'écran** : Activation/délai

**KDE Power Management :**
1. **System Settings** → Power Management
2. **Profils disponibles** :
   - **AC Power** : Sur secteur
   - **Battery** : Sur batterie
   - **Low Battery** : Batterie faible

#### Résolution problèmes suspend

**Suspend ne fonctionne pas :**
```bash
# Vérifier logs d'erreur
journalctl -u systemd-suspend
dmesg | grep -i suspend

# Test manuel des étapes
echo mem | sudo tee /sys/power/state
```

**Réveil impossible :**
```bash
# Vérifier périphériques wake-up
cat /proc/acpi/wakeup

# Activer réveil USB (exemple)
echo enabled | sudo tee /sys/bus/usb/devices/usb1/power/wakeup

# Réveil réseau (Wake-on-LAN)
sudo ethtool -s eth0 wol g  # Activer WOL
```

**Suspend aléatoire :**
```bash
# Désactiver réveil périphériques problématiques
echo disabled | sudo tee /sys/bus/usb/devices/*/power/wakeup

# Vérifier processus bloquant suspend
sudo systemd-inhibit --list
```

### Configuration Hibernate (Hibernation)

#### Prérequis hibernation

**Espace swap nécessaire :**
- **Taille swap ≥ RAM** pour hibernation complète
- **Partition swap** ou fichier swap suffisant

**Vérification swap actuel :**
```bash
# Taille swap disponible
free -h
swapon --show

# Fichiers/partitions swap
cat /proc/swaps
```

#### Création/agrandissement swap

**Si swap insuffisant :**

**Méthode 1 : Fichier swap**
```bash
# Créer fichier swap 8GB (ajuster selon RAM)
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# Rendre permanent
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

**Méthode 2 : Partition swap (avancé)**
- Utiliser **GParted** ou **fdisk**
- Redimensionner partitions existantes
- Créer nouvelle partition swap

#### Activation hibernation

**Configuration GRUB :**
```bash
# Identifier UUID partition/fichier swap
sudo blkid | grep swap
# Ou pour fichier swap :
sudo findmnt -no UUID -T /swapfile

# Éditer GRUB
sudo nano /etc/default/grub

# Ajouter paramètre kernel :
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash resume=UUID=your-swap-uuid"

# Mettre à jour GRUB
sudo update-grub
```

**Configuration initramfs :**
```bash
# Éditer modules initramfs
sudo nano /etc/initramfs-tools/conf.d/resume

# Ajouter ligne :
RESUME=UUID=your-swap-uuid

# Régénérer initramfs
sudo update-initramfs -u -k all
```

**Test hibernation :**
```bash
# Test hibernation
sudo systemctl hibernate

# Vérification après réveil
journalctl -u systemd-hibernate
```

#### Configuration hibernation automatique

**Hibernation sur batterie faible :**
```bash
# Configuration UPower
sudo nano /etc/UPower/UPower.conf

# Paramètres batterie critique :
CriticalPowerAction=Hibernate
```

### Optimisation batterie laptops

#### Installation TLP

**TLP = Advanced Power Management :**
```bash
# Installation TLP
sudo apt install tlp tlp-rdw

# Activation service
sudo systemctl enable tlp
sudo systemctl start tlp

# Configuration automatique
sudo tlp start
```

#### Configuration TLP

**Fichier configuration principal :**
```bash
sudo nano /etc/tlp.conf
```

**Paramètres importants :**
```bash
# Gouverneur CPU sur batterie/secteur
CPU_SCALING_GOVERNOR_ON_AC=performance
CPU_SCALING_GOVERNOR_ON_BAT=powersave

# Fréquences CPU
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=100
CPU_MIN_PERF_ON_BAT=0
CPU_MAX_PERF_ON_BAT=50

# Disques durs
DISK_APM_LEVEL_ON_AC="254 254"
DISK_APM_LEVEL_ON_BAT="128 128"

# WiFi économie énergie
WIFI_PWR_ON_AC=off
WIFI_PWR_ON_BAT=on
```

**Application configuration :**
```bash
sudo tlp start
sudo tlp-stat  # Vérifier statut
```

#### Monitoring consommation

**Outils de surveillance :**
```bash
# Installation PowerTOP
sudo apt install powertop

# Analyse consommation
sudo powertop

# Génération rapport HTML
sudo powertop --html=powertop-report.html
```

**Informations batterie :**
```bash
# État batterie
upower -i $(upower -e | grep 'BAT')

# Historique consommation
upower -i /org/freedesktop/UPower/devices/battery_BAT0
```

### Profils d'alimentation

#### Power Profiles (GNOME moderne)

**Installation :**
```bash
sudo apt install power-profiles-daemon
```

**Profils disponibles :**
- **Performance** : Performances maximales
- **Balanced** : Équilibre performance/autonomie
- **Power Saver** : Autonomie maximale

**Contrôle profils :**
```bash
# Lister profils
powerprofilesctl list

# Changer profil
powerprofilesctl set power-saver
```

#### Configuration manuelle gouverneurs CPU

**Gouverneurs disponibles :**
```bash
# Voir gouverneurs supportés
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors

# Gouverneur actuel
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
```

**Changement manuel :**
```bash
# Performance maximale
echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

# Économie d'énergie
echo powersave | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

# Automatique (recommandé)
echo ondemand | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
```

## 2.3.3 Configuration multi-écrans

### Comprendre l'affichage multi-écrans

#### Technologies d'affichage

**Connexions courantes :**
- **HDMI** : Standard moderne, audio + vidéo
- **DisplayPort** : Haute résolution, daisy-chain possible
- **USB-C/Thunderbolt** : Moderne, haute bande passante
- **VGA** : Analogique, qualité limitée (obsolète)
- **DVI** : Numérique sans audio (ancien)

**Modes d'affichage :**
- **Mirror/Clone** : Même contenu sur tous écrans
- **Extended** : Bureau étendu sur plusieurs écrans
- **Primary only** : Un seul écran actif
- **Secondary only** : Écran principal désactivé

#### Détection écrans

**Commandes de diagnostic :**
```bash
# Écrans détectés
xrandr --listmonitors
xrandr --query

# Exemple sortie :
# Screen 0: minimum 320 x 200, current 3840 x 1080
# HDMI-1 connected 1920x1080+1920+0 (normal left inverted right)
# eDP-1 connected primary 1920x1080+0+0 (normal left inverted right)
```

### Configuration graphique multi-écrans

#### GNOME Settings

**Accès configuration :**
1. **Paramètres** → Écrans
2. **Interface visuelle** : Disposition écrans drag & drop
3. **Options par écran** :
   - Résolution et fréquence
   - Orientation (portrait/paysage)
   - Écran principal
   - Activation/désactivation

**Interface GNOME Displays :**
```
┌─────────────────────────────────────────┐
│   [Monitor 1]     [Monitor 2]           │
│   1920x1080       1920x1080             │
│   ┌─────────┐     ┌─────────┐           │
│   │    1    │     │    2    │           │
│   │         │     │         │           │
│   └─────────┘     └─────────┘           │
│                                         │
│ Resolution: 1920x1080 ▼                 │
│ Refresh Rate: 60 Hz ▼                   │
│ ☐ Primary Display                       │
│ Scale: 100% ▼                           │
└─────────────────────────────────────────┘
```

#### KDE Display Configuration

**System Settings → Display and Monitor :**
- **Visual layout** : Arrangement par glisser-déposer
- **Advanced options** :
  - Gamma correction
  - Color profiles
  - Replica settings
  - Global scaling

#### Résolutions et fréquences

**Résolutions courantes :**
| Format | Résolution | Ratio | Usage |
|--------|------------|-------|-------|
| **Full HD** | 1920x1080 | 16:9 | Standard |
| **QHD** | 2560x1440 | 16:9 | Gaming/Pro |
| **4K UHD** | 3840x2160 | 16:9 | Haute définition |
| **Ultrawide** | 3440x1440 | 21:9 | Productivité |
| **4K** | 4096x2160 | ~17:9 | Professionnel |

**Fréquences d'affichage :**
- **60 Hz** : Standard, fluide
- **75 Hz** : Légèrement plus fluide
- **120/144 Hz** : Gaming compétitif
- **165/240 Hz** : Gaming haute performance

### Configuration ligne de commande (xrandr)

#### Commandes xrandr essentielles

**État actuel :**
```bash
# Informations complètes
xrandr --verbose

# Format simple
xrandr --current
```

**Configuration de base :**
```bash
# Activer second écran à droite
xrandr --output HDMI-1 --auto --right-of eDP-1

# Écran au-dessus
xrandr --output HDMI-1 --auto --above eDP-1

# Résolution spécifique
xrandr --output HDMI-1 --mode 1920x1080 --rate 60

# Désactiver écran
xrandr --output HDMI-1 --off
```

**Exemples configurations courantes :**
```bash
# Configuration laptop + moniteur externe
xrandr --output eDP-1 --primary --mode 1920x1080 --rate 60 \
       --output HDMI-1 --mode 1920x1080 --rate 60 --right-of eDP-1

# Triple écrans (si supporté)
xrandr --output eDP-1 --primary --mode 1920x1080 --rate 60 \
       --output HDMI-1 --mode 1920x1080 --rate 60 --right-of eDP-1 \
       --output DP-1 --mode 1920x1080 --rate 60 --left-of eDP-1

# Mode mirroir
xrandr --output HDMI-1 --same-as eDP-1
```

#### Scripts automatisation

**Script configuration automatique :**
```bash
#!/bin/bash
# ~/.local/bin/setup-displays.sh

# Vérifier si écran externe connecté
if xrandr | grep "HDMI-1 connected"; then
    # Configuration dual screen
    xrandr --output eDP-1 --primary --mode 1920x1080 --rate 60 \
           --output HDMI-1 --mode 1920x1080 --rate 60 --right-of eDP-1
    echo "Dual screen configured"
else
    # Configuration single screen
    xrandr --output eDP-1 --primary --mode 1920x1080 --rate 60
    echo "Single screen configured"
fi
```

**Rendre exécutable et utiliser :**
```bash
chmod +x ~/.local/bin/setup-displays.sh
~/.local/bin/setup-displays.sh
```

### Gestion haute résolution et scaling

#### Problème HiDPI/4K

**Symptômes texte trop petit :**
- Texte illisible sur écrans 4K
- Interface disproportionnée
- Fatigue oculaire

#### Configuration scaling GNOME

**Paramètres → Écrans :**
- **Scale** : 100%, 125%, 150%, 200%
- **Fractional scaling** : Options intermédiaires

**Activation scaling fractionnel :**
```bash
# Activer scaling fractionnel
gsettings set org.gnome.mutter experimental-features "['scale-monitor-framebuffer']"

# Redémarrer session pour appliquer
```

#### Configuration scaling KDE

**System Settings → Display :**
- **Global Scale** : 100% à 300%
- **Per-monitor scaling** : Différent par écran

#### Scaling applications individuelles

**Applications qui ne respectent pas scaling :**
```bash
# Forcer scaling pour application spécifique
QT_SCALE_FACTOR=1.5 application-qt

# Variables d'environnement globales
export GDK_SCALE=1.5        # Applications GTK
export QT_SCALE_FACTOR=1.5  # Applications Qt
```

### Profils d'affichage et automatisation

#### Autorandr - Gestion profils

**Installation :**
```bash
sudo apt install autorandr
```

**Création profils :**
```bash
# Configurer écrans manuellement puis sauver profil
autorandr --save bureau

# Profil laptop seul
autorandr --save mobile

# Changer profil
autorandr --load bureau
```

**Détection automatique :**
```bash
# Activer détection automatique
autorandr --change

# Service automatique
systemctl --user enable autorandr.service
```

#### Configuration démarrage session

**GNOME autostart :**
```bash
# Créer fichier autostart
mkdir -p ~/.config/autostart

cat > ~/.config/autostart/display-setup.desktop << EOF
[Desktop Entry]
Type=Application
Name=Display Setup
Exec=/home/$USER/.local/bin/setup-displays.sh
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
EOF
```

## 2.3.4 Bluetooth et périphériques

### Configuration Bluetooth

#### Installation et activation

**Vérification support Bluetooth :**
```bash
# Matériel Bluetooth détecté
lsusb | grep -i bluetooth
lspci | grep -i bluetooth
hciconfig  # Si bluetoothctl installé

# Statut service
systemctl status bluetooth
```

**Installation stack Bluetooth :**
```bash
# Paquets essentiels
sudo apt install bluetooth bluez bluez-tools

# Interface graphique
sudo apt install blueman  # Gestionnaire universel
# Ou intégré DE :
sudo apt install gnome-bluetooth  # GNOME
sudo apt install bluedevil        # KDE
```

**Activation service :**
```bash
# Démarrer et activer service
sudo systemctl enable bluetooth
sudo systemctl start bluetooth

# Vérifier fonctionnement
sudo systemctl status bluetooth
```

#### Interface en ligne de commande

**bluetoothctl - Outil principal :**
```bash
# Lancer interface interactive
bluetoothctl

# Commandes dans bluetoothctl :
power on              # Activer adaptateur
agent on              # Activer agent d'appairage
default-agent         # Agent par défaut
discoverable on       # Rendre visible
scan on               # Scanner périphériques
pair XX:XX:XX:XX:XX:XX  # Appairer périphérique
connect XX:XX:XX:XX:XX:XX  # Connecter
trust XX:XX:XX:XX:XX:XX    # Faire confiance
disconnect XX:XX:XX:XX:XX:XX  # Déconnecter
remove XX:XX:XX:XX:XX:XX     # Supprimer appairage
quit                  # Quitter
```

#### Configuration graphique

**Blueman Manager :**
- **Interface universelle** compatible tous DE
- **Fonctionnalités** : Appairage, transfert fichiers, audio
- **Accès** : Menu Applications → Bluetooth Manager

**GNOME Settings :**
- **Paramètres** → Bluetooth
- **Interface simplifiée** : On/Off, liste périphériques
- **Appairage automatique** : Clic sur périphérique détecté

**KDE Bluetooth :**
- **System Settings** → Bluetooth
- **Widget plasma** : Contrôle depuis barre tâches
- **Intégration complète** : Notifications, transferts

### Appairage périphériques courants

#### Casques et enceintes Bluetooth

**Processus d'appairage audio :**
1. **Mettre périphérique** en mode appairage
2. **Scanner** avec bluetoothctl ou interface graphique
3. **Sélectionner** périphérique dans liste
4. **Confirmer** appairage (code PIN si demandé)
5. **Configurer** comme périphérique audio

**Configuration audio Bluetooth :**
```bash
# Vérifier périphérique audio détecté
pactl list cards | grep -i bluetooth

# Profils audio disponibles
pactl list cards | grep -A 20 "bluez"
```

**Basculement audio :**
- **pavucontrol** : Onglet "Configuration" → Sélectionner profil
- **GNOME** : Paramètres → Son → Sortie
- **KDE** : Volume → Configuration périphérique

#### Souris et claviers Bluetooth

**Appairage périphériques de saisie :**
```bash
# Mode appairage clavier/souris
bluetoothctl
power on
agent on
scan on

# Attendre détection périphérique
# Exemple : [NEW] Device AA:BB:CC:DD:EE:FF Logitech MX Master 3

pair AA:BB:CC:DD:EE:FF
connect AA:BB:CC:DD:EE:FF
trust AA:BB:CC:DD:EE:FF
```

**Configuration souris avancée :**
```bash
# Installation outils configuration
sudo apt install xinput

# Lister périphériques d'entrée
xinput list

# Configuration souris (vitesse, accélération)
xinput --set-prop "nom-souris" "libinput Accel Speed" 0.5
```

**Claviers avec disposition spéciale :**
```bash
# Configurer layout clavier Bluetooth
setxkbmap fr  # Français
setxkbmap us  # Américain

# Permanent via interface graphique
# GNOME : Paramètres → Clavier
# KDE : System Settings → Input Devices → Keyboard
```

#### Smartphones et tablettes

**Appairage pour transfert fichiers :**
1. **Activer Bluetooth** sur smartphone
2. **Rendre visible** depuis paramètres téléphone
3. **Scanner et appairer** depuis Linux
4. **Accepter** demande d'appairage sur téléphone

**Transfert de fichiers :**
```bash
# Via Blueman (interface graphique)
# Clic droit sur périphérique → Send Files

# Via ligne de commande
bluetooth-sendto --device=AA:BB:CC:DD:EE:FF fichier.pdf
```

**Partage Internet (tethering) :**
```bash
# Configuration réseau Bluetooth
nmcli connection add type bluetooth con-name "Phone Internet" bt-type panu
nmcli connection up "Phone Internet"
```

### Résolution problèmes Bluetooth

#### Problèmes d'appairage

**Périphérique non détecté :**
```bash
# Redémarrer service Bluetooth
sudo systemctl restart bluetooth

# Vérifier adaptateur actif
rfkill list bluetooth
# Si bloqué : rfkill unblock bluetooth

# Reset adaptateur
sudo hciconfig hci0 down
sudo hciconfig hci0 up
```

**Appairage échoue :**
```bash
# Supprimer anciens appairages
bluetoothctl
remove AA:BB:CC:DD:EE:FF

# Nettoyer cache Bluetooth
sudo systemctl stop bluetooth
sudo rm -rf /var/lib/bluetooth/*
sudo systemctl start bluetooth
```

**Audio Bluetooth de mauvaise qualité :**
```bash
# Forcer codec haute qualité
sudo nano /etc/bluetooth/main.conf

# Ajouter/modifier :
[General]
Disable=Headset  # Désactive profil HSP/HFP
Enable=Media     # Active profil A2DP

# Redémarrer service
sudo systemctl restart bluetooth
```

#### Problèmes de connectivité

**Déconnexions fréquentes :**
```bash
# Augmenter timeout connexion
sudo nano /etc/bluetooth/main.conf

# Modifier :
[General]
ConnectionLatency=0
FastConnectable=true
```

**Périphérique connecté mais non fonctionnel :**
```bash
# Vérifier services disponibles
sdptool browse AA:BB:CC:DD:EE:FF

# Reconnecter profil spécifique
bluetoothctl
connect AA:BB:CC:DD:EE:FF
```

### Périphériques USB et drivers

#### Identification périphériques USB

**Commandes de diagnostic :**
```bash
# Liste tous périphériques USB
lsusb

# Détails périphérique spécifique
lsusb -v -d 1234:5678  # ID vendeur:produit

# Monitoring connexions USB temps réel
sudo dmesg -w
# Connecter/déconnecter périphérique pour voir messages
```

#### Périphériques de stockage USB

**Montage automatique :**
- **GNOME/KDE** : Montage automatique en `/media/`
- **Notification** : Apparaît dans gestionnaire de fichiers
- **Démontage sûr** : Clic droit → "Éjecter" avant déconnexion

**Montage manuel :**
```bash
# Identifier périphérique
sudo fdisk -l

# Créer point de montage
sudo mkdir /mnt/usb

# Monter périphérique
sudo mount /dev/sdb1 /mnt/usb

# Démonter proprement
sudo umount /mnt/usb
```

**Formatage clé USB :**
```bash
# ATTENTION : Efface toutes données !

# Format FAT32 (compatible Windows/Mac)
sudo mkfs.vfat -F 32 /dev/sdb1

# Format ext4 (Linux uniquement)
sudo mkfs.ext4 /dev/sdb1

# Via interface graphique
sudo apt install gparted
gparted  # Interface complète partitionnement
```

#### Webcams et caméras

**Test webcam :**
```bash
# Lister périphériques vidéo
ls /dev/video*

# Test avec Cheese (GNOME)
sudo apt install cheese
cheese

# Test ligne de commande
sudo apt install guvcview
guvcview
```

**Applications webcam :**
- **Cheese** : Simple, effet photo amusants
- **Guvcview** : Contrôles avancés, enregistrement
- **OBS Studio** : Streaming, enregistrement professionnel
- **VLC** : Lecture flux caméra

#### Imprimantes

**Installation CUPS (système d'impression) :**
```bash
# Installation serveur impression
sudo apt install cups cups-client

# Interface web CUPS
sudo systemctl start cups
# Accès : http://localhost:631
```

**Ajout imprimante graphique :**
- **GNOME** : Paramètres → Imprimantes → Ajouter
- **KDE** : System Settings → Printers
- **Auto-détection** : La plupart imprimantes détectées automatiquement

**Pilotes imprimantes courants :**
```bash
# HP (excellent support Linux)
sudo apt install hplip
hp-setup  # Assistant configuration HP

# Canon
sudo apt install cups-driver-canon

# Epson
sudo apt install cups-driver-escpr

# Brother
# Téléchargement pilotes depuis site Brother
```

**Impression réseau :**
```bash
# Imprimante partagée Windows
sudo apt install samba-client

# Ajout imprimante SMB/CIFS
# Via interface : smb://ip-imprimante/nom-partage
```

#### Périphériques audio USB

**Interfaces audio USB :**
```bash
# Vérifier détection interface
aplay -l
arecord -l

# Configuration PulseAudio
pavucontrol
# Onglet "Configuration" → Sélectionner profil interface
```

**Microphones USB :**
```bash
# Test enregistrement micro USB
arecord -D plughw:1,0 -f cd test.wav
# Ctrl+C pour arrêter
aplay test.wav  # Écouter enregistrement
```

### Périphériques gaming

#### Manettes de jeu

**Support natif Linux :**
- **Xbox 360/One** : Support excellent, plug & play
- **PlayStation 3/4/5** : Support natif récent
- **Nintendo Switch Pro** : Support via xpadneo
- **Manettes génériques** : Variables selon fabricant

**Installation pilotes manettes :**
```bash
# Xbox (généralement pré-installé)
sudo apt install xboxdrv

# PlayStation via DS4/DS5
sudo apt install ds4drv

# Test manette
sudo apt install jstest-gtk
jstest-gtk  # Interface test boutons/joysticks
```

**Steam et gaming :**
```bash
# Installation Steam
sudo apt install steam

# Steam Input : Support étendu manettes dans Steam
# Paramètres Steam → Contrôleur → Paramètres généraux
```

#### Volants et périphériques spécialisés

**Support Linux gaming :**
- **Logitech** : Bon support (G25, G27, G29, G920)
- **Thrustmaster** : Support variable
- **Fanatec** : Support communautaire

**Configuration volant :**
```bash
# Vérifier détection
lsusb | grep -i logitech

# Test fonctionnement
jstest /dev/input/js0

# Force Feedback (si supporté)
sudo apt install ffmpeg-tools
```

### Périphériques réseau

#### Adaptateurs WiFi USB

**Identification et installation :**
```bash
# Identifier chipset WiFi USB
lsusb | grep -i wireless
dmesg | grep -i firmware

# Installation firmware selon chipset
sudo apt install firmware-realtek     # Realtek
sudo apt install firmware-atheros     # Atheros
sudo apt install firmware-ralink      # Ralink
```

**Adaptateurs USB WiFi recommandés :**
- **Chipsets supportés** : Atheros AR9271, Realtek RTL8188
- **Éviter** : Broadcom, certains Realtek récents
- **Vérifier** compatibility Linux avant achat

#### Adaptateurs Ethernet USB

**Support généralement excellent :**
```bash
# Vérifier détection
ip link show

# Configuration réseau
nmcli device status
nmcli connection show
```

### Résolution problèmes généraux périphériques

#### Permissions et groupes utilisateur

**Ajout aux groupes nécessaires :**
```bash
# Groupes importants pour périphériques
sudo usermod -a -G dialout $USER     # Périphériques série
sudo usermod -a -G plugdev $USER     # Périphériques amovibles
sudo usermod -a -G audio $USER       # Périphériques audio
sudo usermod -a -G video $USER       # Caméras, capture vidéo
sudo usermod -a -G cdrom $USER       # Lecteurs CD/DVD
sudo usermod -a -G bluetooth $USER   # Bluetooth

# Redémarrage session nécessaire
```

#### Règles udev personnalisées

**Création règles udev pour périphériques spéciaux :**
```bash
# Identifier périphérique
lsusb  # Noter ID vendeur:produit

# Créer règle udev
sudo nano /etc/udev/rules.d/99-custom-device.rules

# Exemple règle :
SUBSYSTEM=="usb", ATTR{idVendor}=="1234", ATTR{idProduct}=="5678", MODE="0666", GROUP="plugdev"

# Recharger règles
sudo udevadm control --reload-rules
sudo udevadm trigger
```

#### Logs et diagnostic

**Vérification logs système :**
```bash
# Logs périphériques USB
dmesg | grep -i usb
journalctl -f  # Temps réel

# Logs Bluetooth
journalctl -u bluetooth
dmesg | grep -i bluetooth

# Logs audio
journalctl --user -u pulseaudio
```

**Outils diagnostic avancés :**
```bash
# Informations matériel complètes
sudo lshw -html > hardware-report.html

# Test périphériques système
sudo apt install hardinfo
hardinfo  # Interface graphique diagnostic

# Benchmark et test
sudo apt install phoronix-test-suite
```

Cette configuration complète du matériel et des pilotes vous permet maintenant de profiter pleinement de tous vos périphériques sur Debian, avec une gestion optimale de l'alimentation et des affichages multiples.

⏭️
