üîù Retour au [Sommaire](/SOMMAIRE.md)

# 11.1 Cloud Providers

## Introduction aux Cloud Providers

Les **cloud providers** (fournisseurs de cloud) sont des entreprises qui proposent des services informatiques √† la demande via Internet. Au lieu d'acheter et de maintenir des serveurs physiques, vous pouvez louer de la puissance de calcul, du stockage et des services selon vos besoins.

### Pourquoi utiliser le cloud ?

- **√âconomies** : Pas d'investissement initial en mat√©riel
- **Flexibilit√©** : Ajustez vos ressources selon la demande
- **Rapidit√©** : D√©ployez des serveurs en quelques minutes
- **Fiabilit√©** : Infrastructure redondante et maintenue par des experts
- **√âvolutivit√©** : Passez de 1 √† 1000 serveurs facilement

### Les trois grands du cloud public

1. **Amazon Web Services (AWS)** - Le pionnier et leader du march√©
2. **Google Cloud Platform (GCP)** - L'expertise Google en infrastructure
3. **Microsoft Azure** - La solution Microsoft pour l'entreprise

---

## 11.1.1 AWS CLI et outils sur Debian

### Qu'est-ce qu'AWS ?

Amazon Web Services est la plateforme cloud d'Amazon, lanc√©e en 2006. Elle propose plus de 200 services diff√©rents : serveurs virtuels (EC2), stockage (S3), bases de donn√©es (RDS), et bien d'autres.

### Installation d'AWS CLI

AWS CLI (Command Line Interface) est l'outil en ligne de commande pour g√©rer vos ressources AWS depuis votre syst√®me Debian.

#### M√©thode 1 : Installation via le gestionnaire de paquets

```bash
# Mise √† jour des paquets
sudo apt update

# Installation d'AWS CLI v2
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
sudo apt install unzip
unzip awscliv2.zip
sudo ./aws/install

# V√©rification de l'installation
aws --version
```

#### M√©thode 2 : Via pip (Python)

```bash
# Installation de pip si n√©cessaire
sudo apt install python3-pip

# Installation d'AWS CLI
pip3 install awscli --user

# Ajout au PATH (dans ~/.bashrc)
echo 'export PATH=$PATH:$HOME/.local/bin' >> ~/.bashrc
source ~/.bashrc
```

### Configuration initiale

Avant d'utiliser AWS CLI, vous devez le configurer avec vos identifiants :

```bash
aws configure
```

Le syst√®me vous demandera :
- **Access Key ID** : Votre cl√© d'acc√®s AWS
- **Secret Access Key** : Votre cl√© secr√®te
- **Default region** : La r√©gion par d√©faut (ex: eu-west-1 pour l'Europe)
- **Default output format** : Format de sortie (json recommand√©)

### Commandes de base AWS CLI

```bash
# Lister vos instances EC2
aws ec2 describe-instances

# Lister vos buckets S3
aws s3 ls

# Cr√©er un bucket S3
aws s3 mb s3://mon-bucket-unique-123

# Lister les r√©gions disponibles
aws ec2 describe-regions

# Obtenir des informations sur votre compte
aws sts get-caller-identity
```

### Outils compl√©mentaires utiles

#### AWS Session Manager Plugin
Permet de se connecter aux instances EC2 sans SSH traditionnel :

```bash
curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb" -o "session-manager-plugin.deb"
sudo dpkg -i session-manager-plugin.deb
```

#### AWS SAM CLI (pour le d√©veloppement serverless)
```bash
pip3 install aws-sam-cli
```

---

## 11.1.2 Google Cloud SDK

### Qu'est-ce que Google Cloud Platform ?

Google Cloud Platform (GCP) est la plateforme cloud de Google, qui propose des services bas√©s sur la m√™me infrastructure que Google utilise pour ses produits (Gmail, YouTube, etc.).

### Installation du Google Cloud SDK

#### M√©thode officielle avec le d√©p√¥t Google

```bash
# Ajout de la cl√© GPG de Google
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -

# Ajout du d√©p√¥t Google Cloud SDK
echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list

# Import de la cl√© GPG
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -

# Installation
sudo apt update
sudo apt install google-cloud-cli
```

#### Installation via Snap (alternative)

```bash
sudo snap install google-cloud-cli --classic
```

### Configuration initiale

```bash
# Initialisation et authentification
gcloud init

# Connexion √† votre compte Google
gcloud auth login

# D√©finir le projet par d√©faut
gcloud config set project MON-PROJECT-ID

# D√©finir la r√©gion par d√©faut
gcloud config set compute/region europe-west1
gcloud config set compute/zone europe-west1-b
```

### Commandes de base gcloud

```bash
# Informations sur la configuration actuelle
gcloud config list

# Lister les projets
gcloud projects list

# Lister les instances Compute Engine
gcloud compute instances list

# Lister les clusters Kubernetes
gcloud container clusters list

# Cr√©er une instance VM simple
gcloud compute instances create ma-vm \
    --zone=europe-west1-b \
    --machine-type=e2-micro \
    --image-family=debian-11 \
    --image-project=debian-cloud

# Se connecter √† une instance via SSH
gcloud compute ssh ma-vm --zone=europe-west1-b
```

### Outils sp√©cialis√©s GCP

#### kubectl pour Kubernetes
```bash
# Installation via gcloud
gcloud components install kubectl

# Configuration pour un cluster GKE
gcloud container clusters get-credentials MON-CLUSTER --zone=europe-west1-b
```

#### gsutil pour Google Cloud Storage
Inclus avec le SDK, permet de g√©rer le stockage :

```bash
# Lister les buckets
gsutil ls

# Cr√©er un bucket
gsutil mb gs://mon-bucket-gcp-123

# Copier un fichier vers le cloud
gsutil cp fichier.txt gs://mon-bucket-gcp-123/
```

---

## 11.1.3 Azure CLI

### Qu'est-ce que Microsoft Azure ?

Microsoft Azure est la plateforme cloud de Microsoft, fortement int√©gr√©e avec l'√©cosyst√®me Microsoft (Windows Server, Active Directory, Office 365) mais supportant aussi Linux et les technologies open source.

### Installation d'Azure CLI

#### M√©thode via le script d'installation officiel

```bash
# T√©l√©chargement et ex√©cution du script d'installation
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```

#### M√©thode manuelle avec le d√©p√¥t Microsoft

```bash
# Pr√©-requis
sudo apt update
sudo apt install ca-certificates curl apt-transport-https lsb-release gnupg

# Ajout de la cl√© GPG Microsoft
curl -sL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/microsoft.gpg > /dev/null

# Ajout du d√©p√¥t
AZ_REPO=$(lsb_release -cs)
echo "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ $AZ_REPO main" | sudo tee /etc/apt/sources.list.d/azure-cli.list

# Installation
sudo apt update
sudo apt install azure-cli
```

#### Installation via pip (alternative)

```bash
pip3 install azure-cli
```

### Configuration et authentification

```bash
# Connexion √† Azure
az login

# Lister les abonnements disponibles
az account list

# D√©finir l'abonnement par d√©faut
az account set --subscription "Mon Abonnement"

# Informations sur l'abonnement actuel
az account show
```

### Commandes de base Azure CLI

```bash
# Lister les groupes de ressources
az group list

# Cr√©er un groupe de ressources
az group create --name MonGroupeRessources --location "West Europe"

# Lister les machines virtuelles
az vm list

# Lister les r√©seaux virtuels
az network vnet list

# Cr√©er une machine virtuelle simple
az vm create \
    --resource-group MonGroupeRessources \
    --name MaVM \
    --image Debian:debian-10:10:latest \
    --admin-username adminuser \
    --generate-ssh-keys

# Obtenir l'IP publique d'une VM
az vm show -d -g MonGroupeRessources -n MaVM --query publicIps -o tsv
```

### Extensions utiles Azure CLI

```bash
# Lister les extensions disponibles
az extension list-available

# Installer l'extension Kubernetes
az extension add --name aks-preview

# Installer l'extension pour Azure DevOps
az extension add --name azure-devops
```

---

## 11.1.4 Instances Debian dans le cloud

### Pourquoi choisir Debian dans le cloud ?

- **Stabilit√©** : Debian est r√©put√© pour sa fiabilit√©
- **S√©curit√©** : Mises √† jour r√©guli√®res et cycle de vie pr√©visible
- **L√©g√®ret√©** : Installation minimale id√©ale pour le cloud
- **Flexibilit√©** : Compatible avec tous les services cloud
- **Co√ªt** : Images gratuites sur tous les providers

### Debian sur AWS (Amazon EC2)

#### Images Debian officielles
AWS propose des images Debian officielles maintenues par l'√©quipe Debian :

```bash
# Rechercher les images Debian disponibles
aws ec2 describe-images \
    --owners 136693071363 \
    --filters "Name=name,Values=debian-11-*" \
    --query 'Images[*].[ImageId,Name,CreationDate]' \
    --output table
```

#### Cr√©ation d'une instance Debian

```bash
# Cr√©er une instance EC2 avec Debian 11
aws ec2 run-instances \
    --image-id ami-0c02fb55956c7d316 \
    --instance-type t2.micro \
    --key-name ma-cle-ssh \
    --security-group-ids sg-12345678 \
    --subnet-id subnet-12345678 \
    --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=MonServeurDebian}]'
```

#### Connexion SSH
```bash
# Connexion directe
ssh -i ma-cle-privee.pem admin@adresse-ip-publique

# Ou via AWS Session Manager (plus s√©curis√©)
aws ssm start-session --target i-1234567890abcdef0
```

### Debian sur Google Cloud Platform

#### Images Debian sur GCP
Google maintient des images Debian optimis√©es pour GCP :

```bash
# Lister les images Debian disponibles
gcloud compute images list --project debian-cloud --filter="family:debian-11"
```

#### Cr√©ation d'une instance

```bash
# Cr√©er une VM avec Debian 11
gcloud compute instances create mon-serveur-debian \
    --zone=europe-west1-b \
    --machine-type=e2-micro \
    --network-tier=PREMIUM \
    --maintenance-policy=MIGRATE \
    --image=debian-11-bullseye-v20231010 \
    --image-project=debian-cloud \
    --boot-disk-size=10GB \
    --boot-disk-type=pd-standard \
    --tags=http-server,https-server
```

#### Connexion
```bash
# Connexion SSH via gcloud
gcloud compute ssh mon-serveur-debian --zone=europe-west1-b
```

### Debian sur Microsoft Azure

#### Images Debian sur Azure
Microsoft propose des images Debian dans Azure Marketplace :

```bash
# Rechercher les images Debian
az vm image list --publisher Debian --all --output table
```

#### Cr√©ation d'une machine virtuelle

```bash
# Cr√©er une VM avec Debian 11
az vm create \
    --resource-group MonGroupeRessources \
    --name MonServeurDebian \
    --image Debian:debian-10:10:latest \
    --admin-username adminuser \
    --authentication-type ssh \
    --ssh-key-values ~/.ssh/id_rsa.pub \
    --size Standard_B1s \
    --location "West Europe"
```

#### Connexion SSH
```bash
# R√©cup√©rer l'IP publique
IP_PUBLIQUE=$(az vm show -d -g MonGroupeRessources -n MonServeurDebian --query publicIps -o tsv)

# Connexion SSH
ssh adminuser@$IP_PUBLIQUE
```

### Configuration post-installation commune

Quelque soit le cloud provider, voici les √©tapes recommand√©es apr√®s cr√©ation d'une instance Debian :

#### Mise √† jour du syst√®me
```bash
# Mise √† jour des paquets
sudo apt update && sudo apt upgrade -y

# Installation des outils de base
sudo apt install -y curl wget git htop vim
```

#### Configuration de s√©curit√© de base
```bash
# Configuration du firewall (UFW)
sudo apt install ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw enable

# D√©sactiver l'authentification par mot de passe SSH (optionnel)
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo systemctl restart sshd
```

#### Installation des outils cloud
```bash
# Installer les outils sp√©cifiques au cloud utilis√©
# Pour AWS
sudo apt install awscli

# Pour GCP
echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
sudo apt update && sudo apt install google-cloud-cli

# Pour Azure
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```

### Optimisations sp√©cifiques au cloud

#### Optimisation pour AWS
```bash
# Installation des outils AWS sp√©cifiques
sudo apt install ec2-instance-connect

# Configuration du agent CloudWatch (optionnel)
wget https://s3.amazonaws.com/amazoncloudwatch-agent/debian/amd64/latest/amazon-cloudwatch-agent.deb
sudo dpkg -i amazon-cloudwatch-agent.deb
```

#### Optimisation pour GCP
```bash
# Installation de l'agent Google Cloud Ops
curl -sSO https://dl.google.com/cloudagents/add-google-cloud-ops-agent-repo.sh
sudo bash add-google-cloud-ops-agent-repo.sh --also-install
```

#### Optimisation pour Azure
```bash
# Installation de l'agent Azure Monitor
wget https://github.com/microsoft/OMS-Agent-for-Linux/releases/download/OMSAgent_v1.14.7-0/omsagent-1.14.7-0.universal.x64.sh
sudo sh omsagent-1.14.7-0.universal.x64.sh --upgrade
```

### Bonnes pratiques pour les instances cloud

1. **S√©curit√©** :
   - Utilisez toujours des cl√©s SSH, jamais de mots de passe
   - Configurez un firewall appropri√©
   - Maintenez le syst√®me √† jour

2. **Monitoring** :
   - Installez les agents de monitoring du cloud provider
   - Configurez des alertes pour l'utilisation des ressources
   - Surveillez les logs syst√®me

3. **Sauvegarde** :
   - Configurez des snapshots automatiques des disques
   - Sauvegardez les donn√©es importantes vers le stockage objet
   - Testez r√©guli√®rement vos proc√©dures de restauration

4. **Optimisation des co√ªts** :
   - Choisissez la taille d'instance appropri√©e
   - √âteignez les instances non utilis√©es
   - Utilisez des instances spot/pr√©emptibles pour les workloads tol√©rants aux pannes

5. **Automatisation** :
   - Utilisez des scripts de d√©marrage (cloud-init)
   - Impl√©mentez l'Infrastructure as Code
   - Automatisez les d√©ploiements et la configuration

---

Cette section vous a donn√© les bases pour travailler avec Debian sur les trois principaux cloud providers. Dans la section suivante, nous explorerons les service mesh qui permettent de s√©curiser et g√©rer la communication entre services dans ces environnements cloud.

‚è≠Ô∏è
