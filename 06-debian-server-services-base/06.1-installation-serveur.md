üîù Retour au [Sommaire](/SOMMAIRE.md)

# Module 6.1 : Installation serveur

*Tutoriel accessible aux d√©butants - Niveau : Interm√©diaire*

## Introduction

L'installation d'un serveur Debian diff√®re significativement de l'installation desktop. Un serveur doit √™tre **optimis√©**, **s√©curis√©** et **administrable √† distance**. Ce chapitre vous guide pas-√†-pas dans la cr√©ation d'une base serveur solide et pr√™te pour la production.

---

## 6.1.1 Installation minimale

### Pourquoi une installation minimale ?

Une installation serveur minimale pr√©sente plusieurs avantages cruciaux :

- **S√©curit√© renforc√©e** : Moins de logiciels = moins de vuln√©rabilit√©s potentielles
- **Performance optimale** : Ressources syst√®me d√©di√©es aux services essentiels
- **Maintenance simplifi√©e** : Moins de composants √† maintenir et mettre √† jour
- **Contr√¥le total** : Vous installez uniquement ce dont vous avez besoin

### Pr√©paration de l'installation

#### T√©l√©chargement de l'image Debian

**Option recommand√©e : Image netinst**
- Taille r√©duite (~300 MB)
- Installation des paquets via Internet
- Toujours les derni√®res versions

```bash
# URL de t√©l√©chargement (exemple pour Debian 12)
https://www.debian.org/CD/netinst/
```

**Alternative : Image DVD**
- Plus volumineuse (~3.7 GB)
- Installation sans Internet
- Utile pour environnements isol√©s

#### Cr√©ation du support d'installation

**Sous Linux** :
```bash
# Identifier le p√©riph√©rique USB
sudo fdisk -l

# Cr√©er le support bootable (remplacez /dev/sdX par votre p√©riph√©rique)
sudo dd if=debian-12.x.x-amd64-netinst.iso of=/dev/sdX bs=4M status=progress
sync
```

**Sous Windows** : Utiliser Rufus ou balenaEtcher

### Processus d'installation d√©taill√©

#### D√©marrage et s√©lection de la langue

1. **D√©marrer sur le support USB/DVD**
2. **S√©lectionner "Install"** (pas Graphical Install pour un serveur)
3. **Langue** : Fran√ßais (ou votre langue pr√©f√©r√©e)
4. **Pays** : France
5. **Clavier** : Fran√ßais

> **üí° Astuce d√©butant** : L'installateur en mode texte est plus stable et consomme moins de ressources sur un serveur.

#### Configuration r√©seau initiale

**Nom de machine** :
- Choisir un nom descriptif (ex: `serveur-web-01`, `db-principal`)
- √âviter les caract√®res sp√©ciaux et espaces
- Longueur recommand√©e : 8-15 caract√®res

**Domaine** :
- Si vous avez un domaine : `monentreprise.local`
- Sinon, laisser vide pour l'instant

#### Partitionnement pour serveur

**Strat√©gie recommand√©e pour d√©butants** :

```
/boot     - 512 MB    (ext4)
/         - 15-20 GB  (ext4)
/var      - 10-15 GB  (ext4) - Logs et donn√©es variables
/home     - 5 GB      (ext4) - Comptes utilisateurs
swap      - 2x RAM    (si RAM < 4GB) ou 4GB (si RAM > 4GB)
/srv      - Reste     (ext4) - Donn√©es des services
```

**Explication pour d√©butants** :
- `/boot` : Fichiers de d√©marrage (petite partition s√©par√©e)
- `/` : Syst√®me de base (root)
- `/var` : Logs, caches, donn√©es temporaires des services
- `/home` : R√©pertoires utilisateurs
- `/srv` : Donn√©es des services web, FTP, etc.

> **‚ö†Ô∏è Important** : Cette s√©paration permet d'isoler les donn√©es et facilite les sauvegardes.

#### S√©lection des paquets

**Pour une installation minimale, d√©cocher TOUT sauf** :
- ‚òëÔ∏è **SSH server** (indispensable pour l'administration √† distance)
- ‚òëÔ∏è **Standard system utilities** (outils de base)

**√Ä d√©cocher absolument** :
- ‚ùå Desktop environment (GNOME, KDE, etc.)
- ‚ùå Web server
- ‚ùå Print server
- ‚ùå DNS server

> **üìù Note** : Nous installerons les services sp√©cifiques plus tard, de mani√®re contr√¥l√©e.

### Post-installation imm√©diate

#### Premier d√©marrage

Apr√®s red√©marrage, vous devriez voir :
```
Debian GNU/Linux 12 nom-serveur tty1

nom-serveur login:
```

**Connexion initiale** :
- Utilisateur : `root`
- Mot de passe : celui d√©fini pendant l'installation

#### V√©rification du syst√®me

```bash
# V√©rifier la version du syst√®me
cat /etc/debian_version

# V√©rifier l'espace disque
df -h

# V√©rifier les partitions
lsblk

# V√©rifier la m√©moire
free -h

# V√©rifier les processus actifs
ps aux | head -20
```

---

## 6.1.2 Configuration r√©seau serveur

### Comprendre la configuration r√©seau Debian

Debian utilise diff√©rents syst√®mes pour g√©rer le r√©seau :
- **ifupdown** : M√©thode traditionnelle (fichier `/etc/network/interfaces`)
- **NetworkManager** : Plus moderne, mais g√©n√©ralement √©vit√© sur serveur
- **systemd-networkd** : Alternative moderne

**Pour un serveur, nous utiliserons ifupdown** (plus pr√©visible et stable).

### Configuration IP statique

#### Pourquoi une IP statique sur serveur ?

- **Accessibilit√© constante** : L'IP ne change jamais
- **Configuration DNS** : Facilite la cr√©ation d'enregistrements
- **S√©curit√©** : R√®gles de pare-feu pr√©cises
- **Services** : Certains services n√©cessitent une IP fixe

#### √âdition du fichier de configuration

```bash
# Sauvegarder la configuration actuelle
cp /etc/network/interfaces /etc/network/interfaces.backup

# √âditer la configuration
nano /etc/network/interfaces
```

**Configuration type pour serveur** :
```bash
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface (toujours pr√©sent)
auto lo
iface lo inet loopback

# Interface r√©seau principale
auto eth0
iface eth0 inet static
    address 192.168.1.100/24
    gateway 192.168.1.1
    dns-nameservers 8.8.8.8 8.8.4.4
    dns-search mondomaine.local
```

**Explication des param√®tres** :
- `auto eth0` : Interface activ√©e automatiquement au d√©marrage
- `address` : IP statique avec masque r√©seau (/24 = 255.255.255.0)
- `gateway` : Passerelle (g√©n√©ralement votre box/routeur)
- `dns-nameservers` : Serveurs DNS (ici Google DNS)
- `dns-search` : Domaine de recherche par d√©faut

#### Application de la configuration

```bash
# Red√©marrer le service r√©seau
systemctl restart networking

# Ou red√©marrer l'interface sp√©cifique
ifdown eth0 && ifup eth0

# V√©rifier la configuration
ip addr show eth0
ip route show
```

### Configuration hostname et FQDN

#### D√©finir le nom d'h√¥te

```bash
# V√©rifier le nom actuel
hostname
hostnamectl status

# Changer le nom d'h√¥te de mani√®re permanente
hostnamectl set-hostname serveur-web-01

# V√©rifier le changement
hostname
```

#### Configuration du fichier hosts

```bash
# √âditer le fichier hosts
nano /etc/hosts
```

**Contenu recommand√©** :
```
127.0.0.1       localhost
192.168.1.100   serveur-web-01.mondomaine.local serveur-web-01

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
```

> **üí° Explication** : La ligne avec votre IP permet la r√©solution locale du nom de serveur.

### Test de la connectivit√©

```bash
# Test de connectivit√© locale
ping -c 4 127.0.0.1

# Test vers la passerelle
ping -c 4 192.168.1.1

# Test vers Internet
ping -c 4 8.8.8.8

# Test de r√©solution DNS
nslookup google.com

# V√©rifier les ports ouverts
ss -tulpn
```

---

## 6.1.3 S√©curisation initiale (hardening)

### Pourquoi s√©curiser d√®s l'installation ?

La s√©curisation initiale est **cruciale** car :
- Un serveur est accessible 24h/24
- Les attaques automatis√©es sont constantes
- Il vaut mieux pr√©venir que gu√©rir
- Les bonnes pratiques s'installent d√®s le d√©but

### Mise √† jour du syst√®me

```bash
# Mettre √† jour la liste des paquets
apt update

# Mettre √† jour tous les paquets install√©s
apt upgrade -y

# Mettre √† jour le syst√®me complet si n√©cessaire
apt full-upgrade -y

# Nettoyer les paquets obsol√®tes
apt autoremove -y
apt autoclean
```

> **‚ö†Ô∏è Important** : Toujours effectuer cette √©tape en premier sur un nouveau serveur.

### Gestion des utilisateurs et sudo

#### Cr√©er un utilisateur administrateur

**Pourquoi ne pas utiliser root directement ?**
- S√©curit√© renforc√©e (s√©paration des privil√®ges)
- Tra√ßabilit√© des actions administratives
- Possibilit√© de d√©sactiver root plus tard

```bash
# Cr√©er un nouvel utilisateur
adduser admin-serveur

# Ajouter l'utilisateur au groupe sudo
usermod -aG sudo admin-serveur

# V√©rifier les groupes
groups admin-serveur
```

#### Configuration sudo avanc√©e

```bash
# √âditer la configuration sudo
visudo
```

**Ajouts recommand√©s** :
```bash
# Permettre √† l'utilisateur d'utiliser sudo sans mot de passe pour certaines commandes
admin-serveur ALL=(ALL) NOPASSWD: /bin/systemctl restart *, /bin/systemctl status *

# Log de toutes les commandes sudo
Defaults logfile="/var/log/sudo.log"
Defaults log_year, log_host, log_input, log_output
```

### Configuration SSH s√©curis√©e

#### √âdition de la configuration SSH

```bash
# Sauvegarder la configuration par d√©faut
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# √âditer la configuration
nano /etc/ssh/sshd_config
```

**Configuration s√©curis√©e pour d√©butants** :
```bash
# Port SSH (changer le port par d√©faut)
Port 2222

# Protocole SSH version 2 uniquement
Protocol 2

# D√©sactiver la connexion root directe
PermitRootLogin no

# Authentification par mot de passe (√† d√©sactiver plus tard avec les cl√©s)
PasswordAuthentication yes

# Nombre maximum de tentatives de connexion
MaxAuthTries 3

# Timeout de connexion
ClientAliveInterval 300
ClientAliveCountMax 2

# Utilisateurs autoris√©s √† se connecter
AllowUsers admin-serveur

# D√©sactiver les connexions vides
PermitEmptyPasswords no

# D√©sactiver X11 Forwarding (pas n√©cessaire sur serveur)
X11Forwarding no

# Banner de connexion
Banner /etc/ssh/banner
```

#### Cr√©er un banner de s√©curit√©

```bash
# Cr√©er le fichier banner
nano /etc/ssh/banner
```

**Contenu du banner** :
```
***************************************************************************
                    ACCES RESTREINT - SERVEUR PRIVE
***************************************************************************
Cet ordinateur est un systeme prive. L'acces non autorise est interdit.
Toutes les activites sont surveillees et enregistrees.
***************************************************************************
```

#### Appliquer la configuration SSH

```bash
# Tester la configuration
sshd -t

# Red√©marrer le service SSH
systemctl restart ssh

# V√©rifier que le service fonctionne
systemctl status ssh

# V√©rifier que le nouveau port est ouvert
ss -tulpn | grep :2222
```

> **‚ö†Ô∏è Attention** : Testez la connexion SSH depuis un autre terminal avant de fermer votre session actuelle !

### Configuration de base du pare-feu

#### Installation et configuration d'UFW

**UFW (Uncomplicated Firewall)** est parfait pour d√©buter :

```bash
# Installer UFW s'il n'est pas pr√©sent
apt install ufw -y

# Politique par d√©faut : bloquer tout le trafic entrant
ufw default deny incoming

# Politique par d√©faut : autoriser tout le trafic sortant
ufw default allow outgoing

# Autoriser SSH sur le nouveau port
ufw allow 2222/tcp

# Autoriser HTTP et HTTPS pour plus tard
ufw allow 80/tcp
ufw allow 443/tcp

# Activer le pare-feu
ufw enable

# V√©rifier le statut
ufw status verbose
```

**R√©sultat attendu** :
```
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
2222/tcp                   ALLOW IN    Anywhere
80/tcp                     ALLOW IN    Anywhere
443/tcp                    ALLOW IN    Anywhere
```

### D√©sactivation des services inutiles

```bash
# Lister tous les services actifs
systemctl list-unit-files --type=service --state=enabled

# Services g√©n√©ralement √† d√©sactiver sur un serveur
systemctl disable bluetooth.service
systemctl disable cups.service
systemctl disable avahi-daemon.service

# Arr√™ter imm√©diatement ces services
systemctl stop bluetooth.service
systemctl stop cups.service
systemctl stop avahi-daemon.service
```

### Configuration des logs de s√©curit√©

```bash
# Installer rsyslog s'il n'est pas pr√©sent
apt install rsyslog -y

# Configurer la rotation des logs
nano /etc/logrotate.d/custom-security
```

**Contenu du fichier** :
```
/var/log/auth.log
/var/log/sudo.log
{
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    postrotate
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}
```

---

## 6.1.4 Outils d'administration √† distance

### Pourquoi l'administration √† distance ?

L'administration √† distance est **essentielle** pour un serveur car :
- Acc√®s depuis n'importe o√π
- Pas besoin d'√©cran/clavier sur le serveur
- Possibilit√© d'automatisation
- Gestion de multiples serveurs

### Optimisation de la connexion SSH

#### G√©n√©ration de cl√©s SSH (c√¥t√© client)

**Sur votre poste de travail** :
```bash
# G√©n√©rer une paire de cl√©s RSA 4096 bits
ssh-keygen -t rsa -b 4096 -C "admin@monserveur"

# Ou pour plus de s√©curit√©, utiliser Ed25519
ssh-keygen -t ed25519 -C "admin@monserveur"

# Copier la cl√© publique sur le serveur
ssh-copy-id -p 2222 admin-serveur@192.168.1.100
```

#### Configuration SSH avec cl√©s (c√¥t√© serveur)

Une fois les cl√©s copi√©es, d√©sactiver l'authentification par mot de passe :

```bash
# √âditer la configuration SSH
nano /etc/ssh/sshd_config
```

**Modifier ces lignes** :
```bash
# D√©sactiver l'authentification par mot de passe
PasswordAuthentication no

# S'assurer que l'authentification par cl√© est activ√©e
PubkeyAuthentication yes
```

```bash
# Red√©marrer SSH
systemctl restart ssh
```

> **üí° Test** : Ouvrez un nouveau terminal et testez la connexion sans mot de passe.

#### Configuration du client SSH

**Sur votre poste de travail**, cr√©er un fichier de configuration SSH :

```bash
# Cr√©er le fichier de configuration (si inexistant)
mkdir -p ~/.ssh
nano ~/.ssh/config
```

**Contenu du fichier** :
```bash
Host monserveur
    HostName 192.168.1.100
    Port 2222
    User admin-serveur
    IdentityFile ~/.ssh/id_ed25519
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

**Utilisation** :
```bash
# Connexion simplifi√©e
ssh monserveur

# Au lieu de
ssh -p 2222 admin-serveur@192.168.1.100
```

### Installation d'outils d'administration

#### Installation des paquets essentiels

```bash
# Mise √† jour des paquets
apt update

# Outils de monitoring et diagnostic
apt install -y htop iotop nethogs ncdu tree

# Outils r√©seau
apt install -y net-tools curl wget telnet nmap

# √âditeurs de texte
apt install -y vim nano

# Outils de s√©curit√©
apt install -y fail2ban logwatch

# Utilitaires syst√®me
apt install -y screen tmux rsync unzip
```

#### Configuration de Screen/Tmux pour sessions persistantes

**Screen (plus simple pour d√©buter)** :
```bash
# D√©marrer une session nomm√©e
screen -S admin

# D√©tacher la session : Ctrl+A puis D
# R√©attacher la session
screen -r admin

# Lister les sessions
screen -ls
```

**Tmux (plus puissant)** :
```bash
# D√©marrer une session nomm√©e
tmux new-session -s admin

# D√©tacher la session : Ctrl+B puis D
# R√©attacher la session
tmux attach -t admin

# Lister les sessions
tmux list-sessions
```

> **üí° Avantage** : Vos commandes continuent de s'ex√©cuter m√™me si la connexion SSH se coupe.

### Monitoring et surveillance

#### Configuration de base de Fail2ban

```bash
# Copier la configuration par d√©faut
cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

# √âditer la configuration
nano /etc/fail2ban/jail.local
```

**Configuration SSH** :
```bash
[sshd]
enabled = true
port = 2222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 1800
findtime = 600
```

```bash
# Red√©marrer Fail2ban
systemctl restart fail2ban

# V√©rifier le statut
fail2ban-client status
fail2ban-client status sshd
```

#### Installation de Logwatch

```bash
# Installer Logwatch
apt install -y logwatch

# Configuration de base
nano /etc/logwatch/conf/logwatch.conf
```

**Param√®tres recommand√©s** :
```bash
# Format de sortie
Output = mail

# Adresse email (√† configurer plus tard)
MailTo = admin@mondomaine.com

# Niveau de d√©tail
Detail = Med

# Services √† surveiller
Service = All
```

### Scripts d'administration utiles

#### Script de v√©rification syst√®me

```bash
# Cr√©er le r√©pertoire pour les scripts personnalis√©s
mkdir -p /usr/local/bin

# Cr√©er un script de v√©rification
nano /usr/local/bin/check-system
```

**Contenu du script** :
```bash
#!/bin/bash
# Script de v√©rification syst√®me rapide

echo "=== INFORMATIONS SYST√àME ==="
echo "Date: $(date)"
echo "Uptime: $(uptime)"
echo

echo "=== ESPACE DISQUE ==="
df -h
echo

echo "=== M√âMOIRE ==="
free -h
echo

echo "=== CHARGE CPU ==="
cat /proc/loadavg
echo

echo "=== DERNI√àRES CONNEXIONS ==="
last -5
echo

echo "=== SERVICES CRITIQUES ==="
systemctl status ssh --no-pager -l
systemctl status fail2ban --no-pager -l
```

```bash
# Rendre le script ex√©cutable
chmod +x /usr/local/bin/check-system

# Tester le script
check-system
```

#### Script de mise √† jour automatique

```bash
# Cr√©er le script de mise √† jour
nano /usr/local/bin/update-system
```

**Contenu du script** :
```bash
#!/bin/bash
# Script de mise √† jour s√©curis√©e

# Log des op√©rations
LOG_FILE="/var/log/update-system.log"

echo "=== D√©but mise √† jour: $(date) ===" >> $LOG_FILE

# Mise √† jour de la liste des paquets
apt update >> $LOG_FILE 2>&1

# Mise √† jour des paquets avec confirmation
apt list --upgradable
echo "Proc√©der avec la mise √† jour ? (y/N)"
read -r response
if [[ "$response" =~ ^[Yy]$ ]]; then
    apt upgrade -y >> $LOG_FILE 2>&1
    echo "Mise √† jour termin√©e: $(date)" >> $LOG_FILE

    # Nettoyer les paquets obsol√®tes
    apt autoremove -y >> $LOG_FILE 2>&1
    apt autoclean >> $LOG_FILE 2>&1
else
    echo "Mise √† jour annul√©e par l'utilisateur" >> $LOG_FILE
fi

echo "=== Fin mise √† jour: $(date) ===" >> $LOG_FILE
```

```bash
# Rendre le script ex√©cutable
chmod +x /usr/local/bin/update-system
```

### V√©rification finale de l'installation

#### Checklist de s√©curit√©

```bash
# 1. V√©rifier les services actifs
systemctl list-unit-files --type=service --state=enabled

# 2. V√©rifier la configuration r√©seau
ip addr show
ip route show

# 3. V√©rifier SSH
ss -tulpn | grep :2222

# 4. V√©rifier le pare-feu
ufw status

# 5. V√©rifier Fail2ban
fail2ban-client status

# 6. Tester la connexion SSH avec cl√©s
# (depuis un autre terminal)

# 7. V√©rifier les logs
tail -f /var/log/auth.log
```

#### Documentation de votre configuration

**Cr√©er un fichier de documentation** :
```bash
nano /root/CONFIGURATION-SERVEUR.md
```

**Contenu recommand√©** :
```markdown
# Configuration Serveur - [Date]

## Informations r√©seau
- IP: 192.168.1.100/24
- Gateway: 192.168.1.1
- DNS: 8.8.8.8, 8.8.4.4
- SSH Port: 2222

## Utilisateurs
- admin-serveur: utilisateur administrateur avec sudo

## Services install√©s
- SSH (port 2222)
- UFW (pare-feu)
- Fail2ban

## Prochaines √©tapes
- [ ] Installation serveur web
- [ ] Configuration base de donn√©es
- [ ] Configuration monitoring complet
```

---

## R√©sum√© du chapitre

### Ce que nous avons accompli

‚úÖ **Installation minimale** d'un serveur Debian s√©curis√©
‚úÖ **Configuration r√©seau** avec IP statique
‚úÖ **S√©curisation initiale** (SSH, pare-feu, utilisateurs)
‚úÖ **Outils d'administration** √† distance op√©rationnels

### Points cl√©s √† retenir

- **S√©curit√© first** : S√©curiser d√®s l'installation
- **Administration √† distance** : SSH avec cl√©s obligatoire
- **Monitoring** : Surveiller d√®s le d√©but
- **Documentation** : Documenter chaque configuration

### V√©rifications avant de continuer

Avant de passer aux services (Module 6.2), assurez-vous que :
- La connexion SSH fonctionne parfaitement
- Le pare-feu est correctement configur√©
- Fail2ban prot√®ge contre les intrusions
- Vous pouvez administrer le serveur √† distance

**Votre serveur Debian est maintenant pr√™t √† h√©berger des services de production !**

---

*Prochaine √©tape : Module 6.2 - Configuration du serveur web (Apache/Nginx)*

‚è≠Ô∏è
