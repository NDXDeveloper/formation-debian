üîù Retour au [Sommaire](/SOMMAIRE.md)

# 7.3 Serveur mail

Un serveur mail est l'un des services les plus complexes mais aussi les plus essentiels d'une infrastructure. Il g√®re l'envoi, la r√©ception, le stockage et l'acc√®s aux emails. Contrairement √† Gmail ou Outlook, avoir son propre serveur mail offre un contr√¥le total sur ses donn√©es et communications.

## Comprendre le fonctionnement du mail

**Analogie du service postal :**
- **MTA (Mail Transfer Agent)** = Le bureau de poste principal qui trie et achemine le courrier
- **MDA (Mail Delivery Agent)** = Le facteur qui d√©pose le courrier dans la bo√Æte aux lettres
- **IMAP/POP3** = Les diff√©rentes fa√ßons d'acc√©der √† sa bo√Æte aux lettres
- **Webmail** = Consulter son courrier depuis n'importe o√π via Internet

**Les √©tapes d'un email :**

1. **Alice √©crit** un mail √† bob@monentreprise.local
2. **Le MTA de Alice** (ex: Gmail) contacte le serveur mail de monentreprise.local
3. **Notre serveur Postfix** re√ßoit le mail et v√©rifie s'il l'accepte
4. **Le MDA** stocke le mail dans la bo√Æte de Bob
5. **Bob consulte** son mail via IMAP ou webmail

**Composants de notre serveur mail :**
- **Postfix** : MTA (envoi/r√©ception des mails)
- **Dovecot** : Serveur IMAP/POP3 (acc√®s aux bo√Ætes mail)
- **SpamAssassin** : Filtrage anti-spam
- **Roundcube** : Interface webmail
- **OpenDKIM** : Signature des emails sortants

---

## 7.3.1 Postfix configuration compl√®te

### Qu'est-ce que Postfix ?

Postfix est un serveur de messagerie (MTA) moderne, s√©curis√© et performant. Il remplace l'ancien Sendmail avec une architecture plus simple et plus s√ªre.

**Avantages de Postfix :**
- **S√©curit√©** : Architecture modulaire, principe de moindre privil√®ge
- **Performance** : G√®re des millions de mails par jour
- **Simplicit√©** : Configuration claire et bien document√©e
- **Fiabilit√©** : Tr√®s stable et robuste

### Installation de Postfix

```bash
# Mettre √† jour le syst√®me
sudo apt update

# Installer Postfix
sudo apt install postfix

# Pendant l'installation, choisir :
# - "Internet Site" pour un serveur mail complet
# - "System mail name" : monentreprise.local
```

Si vous avez rat√© la configuration initiale :

```bash
# Reconfigurer Postfix
sudo dpkg-reconfigure postfix
```

### Configuration de base de Postfix

Le fichier principal de configuration est `/etc/postfix/main.cf` :

```bash
# √âditer la configuration principale
sudo nano /etc/postfix/main.cf
```

**Configuration de base compl√®te :**

```bash
#
# Configuration Postfix pour monentreprise.local
#

# === INFORMATIONS DE BASE ===
myhostname = mail.monentreprise.local
mydomain = monentreprise.local
myorigin = $mydomain

# Nom affich√© dans les en-t√™tes
mynetworks_style = subnet
mynetworks = 127.0.0.0/8, 192.168.1.0/24

# === DESTINATIONS ===
# Domaines pour lesquels ce serveur accepte les mails
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain

# Domaines relay√©s (vide pour un serveur final)
relay_domains =

# === BO√éTES MAIL ===
# R√©pertoire de stockage des mails
home_mailbox = Maildir/

# Format des bo√Ætes mail (Maildir recommand√©)
mailbox_command =

# === S√âCURIT√â ===
# D√©sactiver les commandes dangereuses
disable_vrfy_command = yes
smtpd_helo_required = yes

# === RESTRICTIONS D'ACC√àS ===
# Qui peut envoyer des mails via ce serveur
smtpd_recipient_restrictions =
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
    reject_rbl_client zen.spamhaus.org,
    reject_rbl_client bl.spamcop.net,
    permit

# Restrictions sur les exp√©diteurs
smtpd_sender_restrictions =
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_non_fqdn_sender,
    reject_unknown_sender_domain,
    permit

# Restrictions HELO/EHLO
smtpd_helo_restrictions =
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_non_fqdn_helo_hostname,
    reject_invalid_helo_hostname,
    permit

# === TAILLES ET LIMITES ===
message_size_limit = 52428800      # 50 MB par mail
mailbox_size_limit = 1073741824    # 1 GB par bo√Æte mail

# === LOGS ===
# Niveau de d√©tail des logs
smtpd_tls_loglevel = 1
smtp_tls_loglevel = 1

# === AUTHENTIFICATION SASL ===
# N√©cessaire pour que les clients puissent s'authentifier
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $myhostname
broken_sasl_auth_clients = yes
```

**Explication des param√®tres importants :**

- **myhostname** : Nom complet du serveur mail
- **mydomain** : Domaine principal g√©r√© par ce serveur
- **myorigin** : Domaine ajout√© aux adresses locales (user ‚Üí user@monentreprise.local)
- **mydestination** : Domaines pour lesquels accepter les mails entrants
- **home_mailbox** : Format Maildir (un fichier par mail, plus fiable)
- **smtpd_recipient_restrictions** : R√®gles pour accepter/rejeter les mails

### Configuration TLS/SSL pour la s√©curit√©

Le chiffrement est obligatoire pour un serveur mail moderne :

```bash
# G√©n√©rer un certificat auto-sign√© (pour les tests)
sudo openssl req -new -x509 -days 365 -nodes -out /etc/ssl/certs/postfix.pem -keyout /etc/ssl/private/postfix.key

# S√©curiser les permissions
sudo chmod 644 /etc/ssl/certs/postfix.pem
sudo chmod 600 /etc/ssl/private/postfix.key
```

Ajouter √† `/etc/postfix/main.cf` :

```bash
# === CONFIGURATION TLS ===
# Certificat et cl√© priv√©e
smtpd_tls_cert_file = /etc/ssl/certs/postfix.pem
smtpd_tls_key_file = /etc/ssl/private/postfix.key

# Param√®tres TLS
smtpd_use_tls = yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtpd_tls_security_level = may
smtpd_tls_protocols = !SSLv2, !SSLv3

# TLS pour les connexions sortantes
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache
smtp_tls_security_level = may
smtp_tls_protocols = !SSLv2, !SSLv3
```

### Configuration des ports et services

√âditer `/etc/postfix/master.cf` pour configurer les ports :

```bash
sudo nano /etc/postfix/master.cf
```

**Configuration recommand√©e :**

```bash
#
# Configuration des services Postfix
#

# SMTP standard (port 25) - r√©ception des mails externes
smtp      inet  n       -       y       -       -       smtpd

# Submission (port 587) - envoi authentifi√© pour les clients
587       inet  n       -       y       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING

# SMTPS (port 465) - envoi s√©curis√© SSL/TLS
465       inet  n       -       y       -       -       smtpd
  -o syslog_name=postfix/smtps
  -o smtpd_tls_wrappermode=yes
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING

# Services locaux
pickup    unix  n       -       y       60      1       pickup
cleanup   unix  n       -       y       -       0       cleanup
qmgr      unix  n       -       n       300     1       qmgr
tlsmgr    unix  -       -       y       1000?   1       tlsmgr
rewrite   unix  -       -       y       -       -       trivial-rewrite
bounce    unix  -       -       y       -       0       bounce
defer     unix  -       -       y       -       0       bounce
trace     unix  -       -       y       -       0       bounce
verify    unix  -       -       y       -       1       verify
flush     unix  n       -       y       1000?   0       flush
proxymap  unix  -       -       n       -       -       proxymap
proxywrite unix -       -       n       -       1       proxymap
smtp      unix  -       -       y       -       -       smtp
relay     unix  -       -       y       -       -       smtp
showq     unix  n       -       y       -       -       showq
error     unix  -       -       y       -       -       error
retry     unix  -       -       y       -       -       error
discard   unix  -       -       y       -       -       discard
local     unix  -       n       n       -       -       local
virtual   unix  -       n       n       -       -       virtual
lmtp      unix  -       -       y       -       -       lmtp
anvil     unix  -       -       y       -       1       anvil
scache    unix  -       -       y       -       1       scache
```

**Explication des ports :**
- **Port 25** : SMTP standard pour recevoir les mails d'autres serveurs
- **Port 587** : Submission, pour l'envoi authentifi√© (recommand√©)
- **Port 465** : SMTPS, envoi avec SSL/TLS imm√©diat

### Gestion des utilisateurs et alias

**Cr√©er des utilisateurs syst√®me pour les bo√Ætes mail :**

```bash
# Cr√©er un utilisateur pour chaque bo√Æte mail
sudo adduser --system --no-create-home --disabled-login --group jean
sudo adduser --system --no-create-home --disabled-login --group marie
sudo adduser --system --no-create-home --disabled-login --group direction

# Ou pour des vrais utilisateurs (peuvent se connecter au syst√®me)
sudo adduser jean
sudo adduser marie
```

**Configuration des alias :**

```bash
# √âditer le fichier des alias
sudo nano /etc/aliases
```

Contenu exemple :

```bash
# Aliases syst√®me (obligatoires)
postmaster: root
mailer-daemon: postmaster
nobody: root
hostmaster: root
usenet: root
news: root
webmaster: root
www: root
ftp: root
abuse: root

# Aliases d'entreprise
root: admin@monentrepise.local
admin: jean,marie
direction: marie
support: jean
contact: direction
info: direction
commercial: marie

# Listes de diffusion
equipe: jean,marie,direction
all: equipe,support
```

Activer les alias :

```bash
# Construire la base de donn√©es des alias
sudo newaliases

# V√©rifier un alias
sudo postmap -q admin /etc/aliases
```

### Test de la configuration Postfix

```bash
# V√©rifier la syntaxe de la configuration
sudo postfix check

# Recharger la configuration
sudo postfix reload

# Red√©marrer Postfix si n√©cessaire
sudo systemctl restart postfix

# V√©rifier le statut
sudo systemctl status postfix
```

**Tester l'envoi de mail local :**

```bash
# Envoyer un mail de test
echo "Test de configuration Postfix" | mail -s "Test" jean@monentreprise.local

# Voir la queue des mails
sudo postqueue -p

# Voir les logs
sudo tail -f /var/log/mail.log
```

---

## 7.3.2 Dovecot (IMAP/POP3)

### Qu'est-ce que Dovecot ?

Dovecot est un serveur IMAP et POP3 qui permet aux clients mail (Outlook, Thunderbird, smartphones) d'acc√©der aux bo√Ætes mail stock√©es sur le serveur.

**IMAP vs POP3 :**
- **IMAP** : Les mails restent sur le serveur, synchronisation multi-appareils
- **POP3** : Les mails sont t√©l√©charg√©s sur l'appareil, plus simple

**Pourquoi Dovecot :**
- **Performance** : Tr√®s rapide, m√™me avec des millions de mails
- **S√©curit√©** : Support complet de SSL/TLS et authentification moderne
- **Simplicit√©** : Configuration claire et logique
- **Int√©gration** : Fonctionne parfaitement avec Postfix

### Installation de Dovecot

```bash
# Installer Dovecot avec IMAP et POP3
sudo apt install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd

# D√©marrer le service
sudo systemctl start dovecot
sudo systemctl enable dovecot
```

### Configuration de base de Dovecot

**Configuration principale :**

```bash
# √âditer la configuration principale
sudo nano /etc/dovecot/dovecot.conf
```

```bash
#
# Configuration principale Dovecot
#

# Protocoles activ√©s
protocols = imap pop3 lmtp

# √âcouter sur toutes les interfaces
listen = *

# Utilisateur/groupe de fonctionnement
base_dir = /var/run/dovecot/
instance_name = dovecot
login_greeting = Serveur mail monentreprise.local pr√™t.

# Inclure les configurations sp√©cifiques
!include conf.d/*.conf
!include_try local.conf
```

**Configuration de l'authentification :**

```bash
# √âditer la configuration d'authentification
sudo nano /etc/dovecot/conf.d/10-auth.conf
```

```bash
#
# Configuration authentification
#

# D√©sactiver l'authentification en clair sauf si chiffr√©e
disable_plaintext_auth = yes

# M√©canismes d'authentification autoris√©s
auth_mechanisms = plain login

# Inclure les bases de donn√©es d'authentification
!include auth-system.conf.ext
```

**Configuration du mail :**

```bash
# √âditer la configuration des bo√Ætes mail
sudo nano /etc/dovecot/conf.d/10-mail.conf
```

```bash
#
# Configuration stockage mail
#

# Format des bo√Ætes mail (doit correspondre √† Postfix)
mail_location = maildir:~/Maildir

# Utilisateur/groupe propri√©taire des mails
mail_uid = vmail
mail_gid = vmail

# Cr√©er automatiquement les dossiers n√©cessaires
mail_plugins = autocreate

# R√©pertoires de mail
namespace inbox {
    separator = /
    prefix =
    location =
    inbox = yes

    # Dossiers automatiques
    mailbox Drafts {
        special_use = \Drafts
        auto = subscribe
    }
    mailbox Junk {
        special_use = \Junk
        auto = subscribe
    }
    mailbox Trash {
        special_use = \Trash
        auto = subscribe
    }
    mailbox Sent {
        special_use = \Sent
        auto = subscribe
    }
    mailbox "Sent Messages" {
        special_use = \Sent
    }
}
```

**Cr√©er l'utilisateur vmail :**

```bash
# Cr√©er l'utilisateur virtuel pour les mails
sudo adduser --system --no-create-home --disabled-login --group vmail
sudo usermod -d /var/mail vmail
```

**Configuration SSL/TLS :**

```bash
# √âditer la configuration SSL
sudo nano /etc/dovecot/conf.d/10-ssl.conf
```

```bash
#
# Configuration SSL/TLS
#

# Activer SSL
ssl = required

# Certificats (m√™me que Postfix)
ssl_cert = </etc/ssl/certs/postfix.pem
ssl_key = </etc/ssl/private/postfix.key

# Param√®tres SSL
ssl_cipher_list = ALL:!LOW:!SSLv2:ALL:!aNULL:!ADH:!eNULL:!EXP:RC4+RSA:+HIGH:+MEDIUM
ssl_protocols = !SSLv2 !SSLv3

# Pr√©f√©rer les chiffrements du serveur
ssl_prefer_server_ciphers = yes
```

**Configuration des ports :**

```bash
# √âditer la configuration des services
sudo nano /etc/dovecot/conf.d/10-master.conf
```

```bash
#
# Configuration des services et ports
#

service imap-login {
    inet_listener imap {
        port = 143
    }
    inet_listener imaps {
        port = 993
        ssl = yes
    }

    # Performance
    process_min_avail = 0
    process_limit = 1000
}

service pop3-login {
    inet_listener pop3 {
        port = 110
    }
    inet_listener pop3s {
        port = 995
        ssl = yes
    }
}

service lmtp {
    unix_listener lmtp {
        mode = 0600
        user = postfix
        group = postfix
    }

    # Aussi disponible via TCP si n√©cessaire
    inet_listener lmtp {
        address = 127.0.0.1
        port = 24
    }
}

# Service d'authentification pour Postfix
service auth {
    unix_listener /var/spool/postfix/private/auth {
        mode = 0660
        user = postfix
        group = postfix
    }

    unix_listener auth-userdb {
        mode = 0600
        user = vmail
        group = vmail
    }

    user = dovecot
}

service auth-worker {
    user = vmail
}

service dict {
    unix_listener dict {
        mode = 0600
        user = vmail
        group = vmail
    }
}
```

### Int√©gration Postfix-Dovecot

Pour que Postfix utilise Dovecot pour l'authentification et la livraison :

**Modifier la configuration Postfix :**

```bash
# Ajouter √† /etc/postfix/main.cf
sudo nano /etc/postfix/main.cf
```

Ajouter/modifier :

```bash
# === INT√âGRATION DOVECOT ===
# Utiliser Dovecot LMTP pour la livraison locale
virtual_transport = lmtp:unix:private/dovecot-lmtp

# Authentification SASL via Dovecot
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $myhostname
broken_sasl_auth_clients = yes

# Utiliser Dovecot pour la livraison locale
mailbox_transport = lmtp:unix:private/dovecot-lmtp
```

### Test de Dovecot

```bash
# Red√©marrer les services
sudo systemctl restart dovecot
sudo systemctl restart postfix

# V√©rifier que Dovecot √©coute sur les bons ports
sudo netstat -tlnp | grep dovecot

# Devrait afficher :
# tcp 0 0 0.0.0.0:143 0.0.0.0:* LISTEN PID/dovecot
# tcp 0 0 0.0.0.0:993 0.0.0.0:* LISTEN PID/dovecot
# tcp 0 0 0.0.0.0:110 0.0.0.0:* LISTEN PID/dovecot
# tcp 0 0 0.0.0.0:995 0.0.0.0:* LISTEN PID/dovecot

# Tester IMAP manuellement
telnet localhost 143
# Puis taper :
# a1 LOGIN utilisateur motdepasse
# a2 LIST "" "*"
# a3 LOGOUT
```

**Tester avec un vrai client mail :**

Configuration pour Thunderbird/Outlook :
- **Serveur entrant (IMAP)** : mail.monentreprise.local, port 993, SSL/TLS
- **Serveur sortant (SMTP)** : mail.monentreprise.local, port 587, STARTTLS
- **Authentification** : Mot de passe normal
- **Nom d'utilisateur** : jean@monentreprise.local

---

## 7.3.3 Filtrage anti-spam (SpamAssassin)

### Pourquoi filtrer le spam ?

Le spam repr√©sente 80-90% du trafic mail mondial. Sans filtrage :
- **Bo√Ætes mail satur√©es** de messages ind√©sirables
- **Risques de s√©curit√©** (phishing, malware)
- **Perte de productivit√©** √©norme
- **Consommation de ressources** serveur

**SpamAssassin** est la solution de r√©f√©rence pour d√©tecter et marquer le spam.

### Installation de SpamAssassin

```bash
# Installer SpamAssassin et ses d√©pendances
sudo apt install spamassassin spamc

# Cr√©er l'utilisateur pour SpamAssassin
sudo adduser --system --no-create-home --disabled-login --group spamd

# D√©marrer et activer le service
sudo systemctl start spamassassin
sudo systemctl enable spamassassin
```

### Configuration de SpamAssassin

**Configuration principale :**

```bash
# √âditer la configuration
sudo nano /etc/spamassassin/local.cf
```

```bash
#
# Configuration SpamAssassin pour monentreprise.local
#

# === PARAM√àTRES DE BASE ===
# Score n√©cessaire pour consid√©rer un mail comme spam
required_score 5.0

# R√©√©crire le sujet des mails d√©tect√©s comme spam
rewrite_header Subject [***SPAM***]

# Rapport d√©taill√© dans l'en-t√™te du mail
report_safe 0

# === R√âSEAUX DE CONFIANCE ===
# R√©seaux internes (ne pas scanner)
trusted_networks 127.0.0.1 192.168.1.0/24

# === BASES DE DONN√âES EXTERNES ===
# Utiliser les listes noires DNS
skip_rbl_checks 0

# Listes RBL recommand√©es
dns_available yes

# === APPRENTISSAGE BAY√âSIEN ===
# Activer le filtre bay√©sien (apprentissage automatique)
use_bayes 1
bayes_auto_learn 1
bayes_auto_learn_threshold_nonspam 0.1
bayes_auto_learn_threshold_spam 12.0

# Base de donn√©es Bayes
bayes_path /var/lib/spamassassin/.spamassassin/bayes

# === R√àGLES PERSONNALIS√âES ===
# Bonus pour les mails internes
header LOCAL_INTERNAL   From =~ /monentreprise\.local$/
score LOCAL_INTERNAL    -2.0

# Malus pour certains domaines suspects
header SUSPICIOUS_TLD   From =~ /\.(tk|ml|ga|cf)$/
score SUSPICIOUS_TLD    2.0

# === LANGUES ===
# Langues autoris√©es (fran√ßais et anglais)
ok_languages fr en
ok_locales fr en
```

**Configuration du d√©mon :**

```bash
# √âditer la configuration du d√©mon
sudo nano /etc/default/spamassassin
```

```bash
# Activer SpamAssassin
ENABLED=1

# Options du d√©mon
OPTIONS="--create-prefs --max-children 5 --helper-home-dir"

# Utilisateur d'ex√©cution
SPAMD_USER="spamd"
SPAMD_GROUP="spamd"

# R√©pertoire PID
PIDFILE="/var/run/spamd.pid"

# Nice level (priorit√© CPU)
NICE="--nicelevel 10"
```

### Int√©gration avec Postfix

**M√©thode 1 : Via content_filter (recommand√©e)**

Ajouter √† `/etc/postfix/main.cf` :

```bash
# Filtrage anti-spam via SpamAssassin
content_filter = spamassassin
```

Ajouter √† `/etc/postfix/master.cf` :

```bash
# Service SpamAssassin
spamassassin unix -     n       n       -       -       pipe
    user=spamd argv=/usr/bin/spamc -f -e
    /usr/sbin/sendmail -oi -f ${sender} ${recipient}
```

**M√©thode 2 : Via milter (plus avanc√©e)**

```bash
# Installer spamass-milter
sudo apt install spamass-milter

# Configuration dans /etc/postfix/main.cf
smtpd_milters = unix:/spamass/spamass.sock
non_smtpd_milters = unix:/spamass/spamass.sock
milter_default_action = tempfail
```

### Mise √† jour des r√®gles SpamAssassin

```bash
# Mettre √† jour les r√®gles (recommand√© quotidiennement)
sudo sa-update

# Recompiler les r√®gles
sudo sa-compile

# Red√©marrer SpamAssassin
sudo systemctl restart spamassassin
```

**Automatiser les mises √† jour :**

```bash
# Cr√©er un script de mise √† jour
sudo nano /usr/local/bin/update-spamassassin.sh
```

```bash
#!/bin/bash
#
# Mise √† jour quotidienne des r√®gles SpamAssassin
#

LOG_FILE="/var/log/spamassassin-update.log"

# Fonction de log
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> $LOG_FILE
}

log_message "=== D√©but mise √† jour SpamAssassin ==="

# Mise √† jour des r√®gles
if sa-update --verbose >> $LOG_FILE 2>&1; then
    log_message "R√®gles mises √† jour avec succ√®s"

    # Recompiler si n√©cessaire
    if sa-compile >> $LOG_FILE 2>&1; then
        log_message "Compilation r√©ussie"

        # Red√©marrer le service
        systemctl restart spamassassin
        log_message "Service red√©marr√©"
    else
        log_message "Erreur de compilation"
    fi
else
    log_message "Aucune mise √† jour disponible ou erreur"
fi

log_message "=== Fin mise √† jour SpamAssassin ==="
```

```bash
# Rendre le script ex√©cutable
sudo chmod +x /usr/local/bin/update-spamassassin.sh

# Ajouter au cron (tous les jours √† 3h)
sudo crontab -e
# Ajouter : 0 3 * * * /usr/local/bin/update-spamassassin.sh
```

### Apprentissage et optimisation

**Entra√Æner SpamAssassin avec vos mails :**

```bash
# Apprendre √† partir de mails spam
sudo sa-learn --spam /chemin/vers/dossier/spam/

# Apprendre √† partir de mails l√©gitimes
sudo sa-learn --ham /chemin/vers/dossier/ham/

# Voir les statistiques d'apprentissage
sudo sa-learn --dump magic
```

**Cr√©er des dossiers d'apprentissage :**

```bash
# Cr√©er les dossiers
sudo mkdir -p /var/mail/spamassassin/spam
sudo mkdir -p /var/mail/spamassassin/ham

# Permissions
sudo chown -R spamd:spamd /var/mail/spamassassin
```

**Script d'apprentissage automatique :**

```bash
sudo nano /usr/local/bin/spamassassin-learn.sh
```

```bash
#!/bin/bash
#
# Apprentissage automatique SpamAssassin
#

SPAM_DIR="/var/mail/spamassassin/spam"
HAM_DIR="/var/mail/spamassassin/ham"
LOG_FILE="/var/log/spamassassin-learn.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> $LOG_FILE
}

# Apprendre le spam
if [ "$(ls -A $SPAM_DIR 2>/dev/null)" ]; then
    sa-learn --spam $SPAM_DIR/* >> $LOG_FILE 2>&1
    log_message "Apprentissage spam : $(ls $SPAM_DIR | wc -l) messages"
    rm -f $SPAM_DIR/*
fi

# Apprendre le ham (mails l√©gitimes)
if [ "$(ls -A $HAM_DIR 2>/dev/null)" ]; then
    sa-learn --ham $HAM_DIR/* >> $LOG_FILE 2>&1
    log_message "Apprentissage ham : $(ls $HAM_DIR | wc -l) messages"
    rm -f $HAM_DIR/*
fi

# Statistiques
sa-learn --dump magic >> $LOG_FILE 2>&1
```

### Test du filtrage anti-spam

```bash
# Red√©marrer les services
sudo systemctl restart spamassassin
sudo systemctl restart postfix

# Tester avec l'email de test GTUBE (Generic Test for Unsolicited Bulk Email)
echo 'XJS*C4JABQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X' | mail -s "Test SPAM" jean@monentreprise.local

# V√©rifier que le mail a √©t√© marqu√© comme spam
sudo tail -f /var/log/mail.log
# Chercher des lignes comme : "spamd: identified spam"

# Tester SpamAssassin directement
echo "Subject: Test normal mail
From: test@example.com
To: jean@monentreprise.local

Ceci est un mail de test normal." | spamassassin -t

# Le score devrait √™tre faible (< 5.0)
```

**Surveiller l'efficacit√© du filtrage :**

```bash
# Cr√©er un script de statistiques
sudo nano /usr/local/bin/spam-stats.sh
```

```bash
#!/bin/bash
#
# Statistiques anti-spam quotidiennes
#

LOG_FILE="/var/log/spam-stats.log"
MAIL_LOG="/var/log/mail.log"

# Compter les mails trait√©s aujourd'hui
TODAY=$(date '+%Y-%m-%d')
TOTAL_MAILS=$(grep "$TODAY" $MAIL_LOG | grep "postfix/pickup" | wc -l)
SPAM_MAILS=$(grep "$TODAY" $MAIL_LOG | grep "spamd.*identified spam" | wc -l)
HAM_MAILS=$((TOTAL_MAILS - SPAM_MAILS))

# Calculer le pourcentage
if [ $TOTAL_MAILS -gt 0 ]; then
    SPAM_PERCENT=$(echo "scale=1; $SPAM_MAILS * 100 / $TOTAL_MAILS" | bc)
else
    SPAM_PERCENT=0
fi

# Log des statistiques
echo "[$TODAY] Total: $TOTAL_MAILS, Spam: $SPAM_MAILS ($SPAM_PERCENT%), Ham: $HAM_MAILS" >> $LOG_FILE

# Statistiques Bayes
echo "[$TODAY] Statistiques Bayes:" >> $LOG_FILE
sa-learn --dump magic 2>/dev/null | grep -E "(ham|spam) learned" >> $LOG_FILE
```

```bash
sudo chmod +x /usr/local/bin/spam-stats.sh

# Ex√©cuter quotidiennement √† 23h55
sudo crontab -e
# Ajouter : 55 23 * * * /usr/local/bin/spam-stats.sh
```

---

## 7.3.4 Webmail et clients

### Installation de Roundcube (Webmail)

Roundcube est une interface webmail moderne qui permet de consulter ses emails depuis n'importe quel navigateur.

**Avantages de Roundcube :**
- **Interface moderne** et intuitive
- **Multi-langues** (fran√ßais inclus)
- **Plugins** pour √©tendre les fonctionnalit√©s
- **S√©curis√©** et r√©guli√®rement mis √† jour

```bash
# Installer les pr√©requis
sudo apt install apache2 php php-mysql php-mbstring php-intl php-xml php-zip php-gd php-imap mariadb-server

# T√©l√©charger Roundcube
cd /tmp
wget https://github.com/roundcube/roundcubemail/releases/download/1.6.4/roundcubemail-1.6.4-complete.tar.gz

# Extraire dans le r√©pertoire web
sudo tar -xzf roundcubemail-1.6.4-complete.tar.gz -C /var/www/
sudo mv /var/www/roundcubemail-1.6.4 /var/www/roundcube

# Permissions
sudo chown -R www-data:www-data /var/www/roundcube
sudo chmod -R 755 /var/www/roundcube
```

### Configuration de la base de donn√©es

```bash
# Se connecter √† MariaDB
sudo mysql -u root -p

# Cr√©er la base de donn√©es et l'utilisateur
CREATE DATABASE roundcube;
CREATE USER 'roundcube'@'localhost' IDENTIFIED BY 'motdepasse_securise';
GRANT ALL PRIVILEGES ON roundcube.* TO 'roundcube'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# Importer le sch√©ma de base
sudo mysql -u roundcube -p roundcube < /var/www/roundcube/SQL/mysql.initial.sql
```

### Configuration de Roundcube

```bash
# Copier le fichier de configuration exemple
sudo cp /var/www/roundcube/config/config.inc.php.sample /var/www/roundcube/config/config.inc.php

# √âditer la configuration
sudo nano /var/www/roundcube/config/config.inc.php
```

**Configuration principale :**

```php
<?php
//
// Configuration Roundcube pour monentreprise.local
//

// === BASE DE DONN√âES ===
$config['db_dsnw'] = 'mysql://roundcube:motdepasse_securise@localhost/roundcube';

// === SERVEURS MAIL ===
// Configuration IMAP
$config['default_host'] = array(
    'ssl://mail.monentreprise.local' => 'Serveur Mail Entreprise'
);
$config['default_port'] = 993;
$config['imap_conn_options'] = array(
    'ssl' => array(
        'verify_peer' => false,
        'verify_peer_name' => false,
    ),
);

// Configuration SMTP
$config['smtp_server'] = 'ssl://mail.monentreprise.local';
$config['smtp_port'] = 465;
$config['smtp_user'] = '%u';  // Utiliser l'identifiant de l'utilisateur
$config['smtp_pass'] = '%p';  // Utiliser son mot de passe
$config['smtp_conn_options'] = array(
    'ssl' => array(
        'verify_peer' => false,
        'verify_peer_name' => false,
    ),
);

// === PARAM√àTRES G√âN√âRAUX ===
// Nom du serveur affich√©
$config['product_name'] = 'Webmail MonEntreprise';

// Support URL
$config['support_url'] = 'mailto:admin@monentreprise.local';

// Cl√© de chiffrement (g√©n√©rer une cl√© unique)
$config['des_key'] = 'rcmail-!24ByteDESkey*Str';

// === INTERFACE ===
// Langue par d√©faut
$config['language'] = 'fr_FR';

// Skin par d√©faut
$config['skin'] = 'elastic';

// Fuseau horaire
$config['timezone'] = 'Europe/Paris';

// === S√âCURIT√â ===
// Force HTTPS
$config['force_https'] = true;

// Dur√©e de session (30 minutes)
$config['session_lifetime'] = 30;

// V√©rification des referrers
$config['referer_check'] = true;

// === FONCTIONNALIT√âS ===
// Plugins activ√©s
$config['plugins'] = array(
    'filesystem_attachments',
    'jqueryui',
    'emoticons',
    'archive',
    'zipdownload',
    'managesieve'  // Gestion des filtres c√¥t√© serveur
);

// Taille maximale des pi√®ces jointes (50MB)
$config['max_message_size'] = '50M';

// === DOSSIERS ===
// Dossiers sp√©ciaux
$config['drafts_mbox'] = 'Drafts';
$config['junk_mbox'] = 'Junk';
$config['sent_mbox'] = 'Sent';
$config['trash_mbox'] = 'Trash';
$config['default_folders'] = array('INBOX', 'Drafts', 'Sent', 'Junk', 'Trash');

// Auto-cr√©ation des dossiers
$config['create_default_folders'] = true;

// === LOGS ===
// Niveau de log
$config['log_level'] = 1;  // 1=erreurs, 4=debug

// Fichier de log
$config['log_dir'] = '/var/log/roundcube/';
?>
```

### Configuration Apache pour Roundcube

```bash
# Cr√©er le r√©pertoire de logs
sudo mkdir -p /var/log/roundcube
sudo chown www-data:www-data /var/log/roundcube

# Cr√©er la configuration du site Apache
sudo nano /etc/apache2/sites-available/roundcube.conf
```

```apache
<VirtualHost *:80>
    ServerName webmail.monentreprise.local
    DocumentRoot /var/www/roundcube

    # Redirection vers HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName webmail.monentreprise.local
    DocumentRoot /var/www/roundcube

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/postfix.pem
    SSLCertificateKeyFile /etc/ssl/private/postfix.key

    # R√©pertoires
    <Directory /var/www/roundcube>
        Options -Indexes
        AllowOverride All
        Require all granted
    </Directory>

    # S√©curit√© suppl√©mentaire
    <Directory /var/www/roundcube/config>
        Require all denied
    </Directory>

    <Directory /var/www/roundcube/logs>
        Require all denied
    </Directory>

    <Directory /var/www/roundcube/temp>
        Require all denied
    </Directory>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/roundcube_error.log
    CustomLog ${APACHE_LOG_DIR}/roundcube_access.log combined
</VirtualHost>
```

```bash
# Activer les modules Apache n√©cessaires
sudo a2enmod rewrite ssl

# Activer le site
sudo a2ensite roundcube.conf

# Recharger Apache
sudo systemctl reload apache2
```

### Configuration des clients mail

**Configuration g√©n√©rique pour tout client mail :**

**Param√®tres serveur entrant (IMAP) :**
- **Serveur** : mail.monentreprise.local
- **Port** : 993
- **S√©curit√©** : SSL/TLS
- **Authentification** : Mot de passe normal
- **Nom d'utilisateur** : jean@monentreprise.local

**Param√®tres serveur sortant (SMTP) :**
- **Serveur** : mail.monentreprise.local
- **Port** : 587 (ou 465)
- **S√©curit√©** : STARTTLS (ou SSL/TLS pour 465)
- **Authentification** : Requise
- **Nom d'utilisateur** : jean@monentreprise.local

### Configuration automatique (Autodiscover)

Pour que les clients se configurent automatiquement, cr√©er un fichier de configuration :

```bash
# Cr√©er le r√©pertoire pour l'autodiscover
sudo mkdir -p /var/www/autoconfig/mail

# Cr√©er la configuration Mozilla/Thunderbird
sudo nano /var/www/autoconfig/mail/config-v1.1.xml
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<clientConfig version="1.1">
  <emailProvider id="monentreprise.local">
    <domain>monentreprise.local</domain>
    <displayName>Mail MonEntreprise</displayName>
    <displayShortName>MonEntreprise</displayShortName>

    <!-- IMAP -->
    <incomingServer type="imap">
      <hostname>mail.monentreprise.local</hostname>
      <port>993</port>
      <socketType>SSL</socketType>
      <authentication>password-cleartext</authentication>
      <username>%EMAILADDRESS%</username>
    </incomingServer>

    <!-- SMTP -->
    <outgoingServer type="smtp">
      <hostname>mail.monentreprise.local</hostname>
      <port>587</port>
      <socketType>STARTTLS</socketType>
      <authentication>password-cleartext</authentication>
      <username>%EMAILADDRESS%</username>
    </outgoingServer>

  </emailProvider>
</clientConfig>
```

```bash
# Configuration pour Outlook (Autodiscover)
sudo nano /var/www/autodiscover/autodiscover.xml
```

```xml
<?xml version="1.0" encoding="utf-8" ?>
<Autodiscover xmlns="http://schemas.microsoft.com/exchange/autodiscover/responseschema/2006">
  <Response xmlns="http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a">
    <Account>
      <AccountType>email</AccountType>
      <Action>settings</Action>
      <Protocol>
        <Type>IMAP</Type>
        <Server>mail.monentreprise.local</Server>
        <Port>993</Port>
        <DomainRequired>off</DomainRequired>
        <LoginName>%EMAILADDRESS%</LoginName>
        <SPA>off</SPA>
        <SSL>on</SSL>
        <AuthRequired>on</AuthRequired>
      </Protocol>
      <Protocol>
        <Type>SMTP</Type>
        <Server>mail.monentreprise.local</Server>
        <Port>587</Port>
        <DomainRequired>off</DomainRequired>
        <LoginName>%EMAILADDRESS%</LoginName>
        <SPA>off</SPA>
        <Encryption>TLS</Encryption>
        <AuthRequired>on</AuthRequired>
        <UsePOPAuth>on</UsePOPAuth>
        <SMTPLast>off</SMTPLast>
      </Protocol>
    </Account>
  </Response>
</Autodiscover>
```

---

## 7.3.5 DKIM, SPF, DMARC

Ces trois technologies forment le trio de s√©curit√© moderne pour l'authentification des emails. Elles emp√™chent l'usurpation d'identit√© et am√©liorent la d√©livrabilit√©.

### SPF (Sender Policy Framework)

SPF indique quels serveurs sont autoris√©s √† envoyer des mails pour votre domaine.

**Principe :** "Seuls les serveurs list√©s dans mon enregistrement DNS SPF peuvent envoyer des mails en mon nom"

**Cr√©er l'enregistrement SPF :**

```bash
# Ajouter √† votre zone DNS (dans BIND)
sudo nano /etc/bind/zones/db.monentreprise.local
```

Ajouter :

```dns
; Enregistrement SPF
@               IN  TXT     "v=spf1 mx a ip4:192.168.1.10 -all"
```

**Explication de l'enregistrement SPF :**
- **v=spf1** : Version SPF
- **mx** : Les serveurs MX du domaine sont autoris√©s
- **a** : Le serveur A du domaine est autoris√©
- **ip4:192.168.1.10** : Cette IP sp√©cifique est autoris√©e
- **-all** : Rejeter tous les autres serveurs (strict)

**Alternatives pour -all :**
- **-all** : Rejet strict (recommand√© en production)
- **~all** : Soft fail (marqu√© suspect mais pas rejet√©)
- **+all** : Autoriser tout (d√©conseill√©)

### DKIM (DomainKeys Identified Mail)

DKIM signe cryptographiquement vos emails pour prouver qu'ils viennent bien de vous.

**Installation d'OpenDKIM :**

```bash
# Installer OpenDKIM
sudo apt install opendkim opendkim-tools

# Cr√©er les r√©pertoires
sudo mkdir -p /etc/opendkim/keys
sudo chown -R opendkim:opendkim /etc/opendkim
sudo chmod -R 700 /etc/opendkim/keys
```

**Configuration d'OpenDKIM :**

```bash
# Configuration principale
sudo nano /etc/opendkim.conf
```

```bash
#
# Configuration OpenDKIM
#

# Mode de fonctionnement
Mode                    sv
PidFile                 /var/run/opendkim/opendkim.pid
UMask                   002
UserID                  opendkim:opendkim
Socket                  local:/var/spool/postfix/opendkim/opendkim.sock

# Domaines et cl√©s
Domain                  monentreprise.local
Selector                mail
KeyFile                 /etc/opendkim/keys/monentreprise.local/mail.private
Canonicalization        relaxed/simple

# S√©curit√©
SignatureAlgorithm      rsa-sha256
MinimumKeyBits          1024

# Logs
Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes

# Tables externes
KeyTable                /etc/opendkim/KeyTable
SigningTable            /etc/opendkim/SigningTable
ExternalIgnoreList      /etc/opendkim/TrustedHosts
InternalHosts           /etc/opendkim/TrustedHosts
```

**G√©n√©rer les cl√©s DKIM :**

```bash
# Cr√©er le r√©pertoire pour le domaine
sudo mkdir /etc/opendkim/keys/monentreprise.local

# G√©n√©rer la paire de cl√©s
sudo opendkim-genkey -s mail -d monentreprise.local -D /etc/opendkim/keys/monentreprise.local

# Ajuster les permissions
sudo chown -R opendkim:opendkim /etc/opendkim/keys
sudo chmod 600 /etc/opendkim/keys/monentreprise.local/mail.private
```

**Cr√©er les fichiers de configuration :**

```bash
# KeyTable : Associe les cl√©s aux domaines
sudo nano /etc/opendkim/KeyTable
```

```
mail._domainkey.monentreprise.local monentreprise.local:mail:/etc/opendkim/keys/monentreprise.local/mail.private
```

```bash
# SigningTable : Quels domaines signer
sudo nano /etc/opendkim/SigningTable
```

```
*@monentreprise.local mail._domainkey.monentreprise.local
```

```bash
# TrustedHosts : Serveurs de confiance
sudo nano /etc/opendkim/TrustedHosts
```

```
127.0.0.1
localhost
192.168.1.0/24
*.monentreprise.local
monentreprise.local
```

**Ajouter l'enregistrement DNS DKIM :**

```bash
# Voir la cl√© publique g√©n√©r√©e
sudo cat /etc/opendkim/keys/monentreprise.local/mail.txt
```

Copier cette cl√© dans votre zone DNS :

```dns
; Enregistrement DKIM
mail._domainkey IN  TXT     "v=DKIM1; h=sha256; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..."
```

**Int√©grer DKIM avec Postfix :**

```bash
# Cr√©er le r√©pertoire socket
sudo mkdir -p /var/spool/postfix/opendkim
sudo chown opendkim:postfix /var/spool/postfix/opendkim

# Ajouter √† /etc/postfix/main.cf
sudo nano /etc/postfix/main.cf
```

Ajouter :

```bash
# Configuration DKIM
smtpd_milters = unix:/opendkim/opendkim.sock
non_smtpd_milters = unix:/opendkim/opendkim.sock
milter_default_action = accept
milter_protocol = 6
```

### DMARC (Domain-based Message Authentication)

DMARC utilise SPF et DKIM pour d√©cider quoi faire des mails qui √©chouent √† l'authentification.

**Cr√©er l'enregistrement DMARC :**

```bash
# Ajouter √† votre zone DNS
sudo nano /etc/bind/zones/db.monentreprise.local
```

```dns
; Enregistrement DMARC
_dmarc          IN  TXT     "v=DMARC1; p=quarantine; rua=mailto:dmarc@monentreprise.local; ruf=mailto:dmarc@monentreprise.local; sp=quarantine; adkim=r; aspf=r"
```

**Explication de l'enregistrement DMARC :**
- **v=DMARC1** : Version DMARC
- **p=quarantine** : Politique (none/quarantine/reject)
- **rua** : Adresse pour les rapports agr√©g√©s
- **ruf** : Adresse pour les rapports d√©taill√©s
- **sp=quarantine** : Politique pour les sous-domaines
- **adkim=r** : Alignement DKIM relaxed
- **aspf=r** : Alignement SPF relaxed

**√âvolution progressive de la politique DMARC :**

1. **Phase 1** : `p=none` (monitoring seulement)
2. **Phase 2** : `p=quarantine` (mise en quarantaine)
3. **Phase 3** : `p=reject` (rejet total)

### Red√©marrage et test complet

```bash
# Red√©marrer tous les services
sudo systemctl restart opendkim
sudo systemctl restart postfix

# V√©rifier que tout fonctionne
sudo systemctl status opendkim postfix

# Tester les enregistrements DNS
dig TXT monentreprise.local | grep spf
dig TXT mail._domainkey.monentreprise.local
dig TXT _dmarc.monentreprise.local
```

### Test de la configuration compl√®te

**Envoyer un email de test :**

```bash
# Envoyer un mail √† un service de test comme mail-tester.com
echo "Test de configuration mail compl√®te" | mail -s "Test DKIM/SPF/DMARC" check@mail-tester.com

# Ou utiliser swaks (Swiss Army Knife for SMTP)
sudo apt install swaks
swaks --to check@mail-tester.com --from test@monentreprise.local --server localhost --port 587 --auth --auth-user jean@monentreprise.local
```

### Monitoring et maintenance

**Script de surveillance mail complet :**

```bash
sudo nano /usr/local/bin/monitor-mail-server.sh
```

```bash
#!/bin/bash
#
# Monitoring serveur mail complet
#

LOG_FILE="/var/log/mail-server-monitor.log"
DOMAIN="monentreprise.local"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> $LOG_FILE
}

log_message "=== D√©but monitoring serveur mail ==="

# V√©rifier les services
services=("postfix" "dovecot" "opendkim" "spamassassin")
for service in "${services[@]}"; do
    if systemctl is-active --quiet $service; then
        log_message "‚úì Service $service actif"
    else
        log_message "‚úó ALERTE: Service $service arr√™t√©!"
    fi
done

# V√©rifier les enregistrements DNS
if dig TXT $DOMAIN | grep -q "v=spf1"; then
    log_message "‚úì Enregistrement SPF pr√©sent"
else
    log_message "‚úó ALERTE: Enregistrement SPF manquant!"
fi

if dig TXT mail._domainkey.$DOMAIN | grep -q "v=DKIM1"; then
    log_message "‚úì Enregistrement DKIM pr√©sent"
else
    log_message "‚úó ALERTE: Enregistrement DKIM manquant!"
fi

if dig TXT _dmarc.$DOMAIN | grep -q "v=DMARC1"; then
    log_message "‚úì Enregistrement DMARC pr√©sent"
else
    log_message "‚úó ALERTE: Enregistrement DMARC manquant!"
fi

# Statistiques des queues mail
QUEUE_SIZE=$(postqueue -p | tail -n1 | awk '{print $5}')
if [ "$QUEUE_SIZE" != "empty" ] && [ ${QUEUE_SIZE:-0} -gt 100 ]; then
    log_message "‚ö† ATTENTION: Queue mail importante ($QUEUE_SIZE messages)"
else
    log_message "‚úì Queue mail normale"
fi

# V√©rifier l'espace disque
DISK_USAGE=$(df /var | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    log_message "‚ö† ATTENTION: Espace disque faible ($DISK_USAGE%)"
fi

log_message "=== Fin monitoring serveur mail ==="
```

```bash
sudo chmod +x /usr/local/bin/monitor-mail-server.sh

# Ex√©cuter toutes les 15 minutes
sudo crontab -e
# Ajouter : */15 * * * * /usr/local/bin/monitor-mail-server.sh
```

---

## R√©sum√© du chapitre Serveur Mail

Dans cette section compl√®te, nous avons configur√© :

‚úÖ **Postfix** comme MTA avec s√©curit√© TLS et authentification SASL
‚úÖ **Dovecot** pour l'acc√®s IMAP/POP3 aux bo√Ætes mail
‚úÖ **SpamAssassin** pour le filtrage anti-spam intelligent
‚úÖ **Roundcube** comme webmail moderne et s√©curis√©
‚úÖ **DKIM, SPF, DMARC** pour l'authentification et la r√©putation
‚úÖ **Monitoring** complet et maintenance automatis√©e

**Architecture finale :**
```
Internet ‚Üê‚Üí [Postfix + DKIM] ‚Üê‚Üí [SpamAssassin] ‚Üê‚Üí [Dovecot] ‚Üê‚Üí [Roundcube]
              ‚Üì                    ‚Üì              ‚Üì           ‚Üì
           [Port 25,587,465]   [Filtrage]    [IMAP 993]  [Web HTTPS]
```

**Points cl√©s √† retenir :**

- **Un serveur mail est complexe** mais offre un contr√¥le total
- **La s√©curit√© est primordiale** : TLS, authentification, filtrage
- **SPF/DKIM/DMARC** sont obligatoires pour une bonne d√©livrabilit√©
- **Le monitoring continu** est essentiel pour d√©tecter les probl√®mes
- **Les sauvegardes r√©guli√®res** des mails sont cruciales
- **La maintenance pr√©ventive** √©vite les pannes

Votre serveur mail est maintenant professionnel et s√©curis√©. Dans la section suivante, nous verrons comment configurer un serveur proxy pour optimiser et contr√¥ler l'acc√®s web !

**Conseil de s√©curit√© :**
Surveillez r√©guli√®rement vos logs mail et mettez √† jour tous les composants. Un serveur mail compromis peut rapidement devenir une source de spam, ce qui nuira √† votre r√©putation.

‚è≠Ô∏è
